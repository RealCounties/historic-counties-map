<meta name="color-scheme" content="light dark">
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Historic Counties Interactive Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
<style>
:root {
  --bg: #faf4e6; --card-bg: #f3e9da; --text: #333; --border: #ccc;
  --shadow: rgba(0,0,0,0.2); --accent: #9B2C2C; --tooltip-bg: rgba(255,255,255,0.9);
}
html, body { height:100%; margin:0; font-family:Arial,sans-serif; }
#container { display:flex; height:100%; }
#logo-container { text-align:center; margin-bottom:10px; }
#sidebar-logo { max-width:50%; height:auto; display:block; margin:0 auto; opacity:0; transform:scale(0.9); animation:logoLoad 1.4s ease-out forwards; }
@keyframes logoLoad { 0% { opacity:0; transform:scale(0.9) translateY(10px); } 60% { opacity:1; transform:scale(1.02); } 100% { opacity:1; transform:scale(1); } }
#logo-link { display:block; transition:opacity .25s ease; } #logo-link:hover { opacity:.85; }
#sidebar { width:340px; background:var(--bg); padding:15px; overflow-y:auto; border-right:1px solid var(--border); transition:all .3s ease; position:relative; color:var(--text); }
#search-bar { margin-top:15px; display:flex; gap:6px; align-items:center; justify-content:center; }
#search-bar input { flex:1; min-width:140px; padding:10px 12px; border:1px solid var(--border); border-radius:4px; font-size:.9rem; color:var(--text); background:#fff; box-shadow:0 2px 4px var(--shadow); transition:all .25s; }
#search-bar input:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(155,44,44,.2); }
#search-bar button { padding:10px 18px; background:var(--accent); color:#FAF4E6; border:none; border-radius:4px; font-weight:500; box-shadow:0 3px 6px var(--shadow); cursor:pointer; transition:all .25s cubic-bezier(.4,0,.2,1); }
#search-bar button:hover { background:#7a2222; transform:translateY(-2px) scale(1.05); box-shadow:0 6px 14px var(--shadow); }
#map { flex:1; background:#e0f2fe; height: 100vh; }
/* ---- CARD LAYOUT WITH FLAG ---- */
.county-card {
  background:var(--card-bg); padding:14px; border-radius:10px;
  box-shadow:0 2px 6px var(--shadow); transition:all .3s ease;
  cursor:pointer; text-align:center; margin-bottom:16px;
}
.county-card:hover { transform:translateY(-6px); box-shadow:0 8px 18px var(--shadow); }
.county-card .flag {
  width:64px; height:auto; border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,.25); margin:0 auto 12px;
  display:block;
}
.county-card .card-body { }
.county-card h3 {
  margin:0 0 12px; font-size:1.25rem; color:var(--text);
  word-wrap:break-word; line-height:1.3; text-align:center;
}
.weather-badge { display:inline-block; font-size:0.82rem; background:rgba(0,0,0,0.1); color:var(--text); padding:6px 12px; border-radius:16px; font-weight:500; box-shadow:0 1px 3px rgba(0,0,0,0.12); }
.weather-underline { width:60px; height:2px; background:var(--accent); margin:8px auto 12px; border-radius:1px; }
.county-card p, .county-card ul { margin:6px 0; }
.county-card a { color:#0066cc; text-decoration:none; } .county-card a:hover { text-decoration:underline; }
.leaf-tooltip.county-tooltip { background:var(--tooltip-bg); border:1px solid var(--accent); color:var(--text); font-weight:bold; padding:2px 6px; border-radius:4px; }
#closeSidebar { display:none; position:absolute; top:10px; right:12px; width:32px; height:32px; font-size:20px; color:#666; background:rgba(255,255,255,0.9); border:none; border-radius:50%; cursor:pointer; align-items:center; justify-content:center; z-index:1001; }
#closeSidebar:hover { background:#fff; }

/* MOBILE: RESPONSIVENESS */
@media (max-width:1024px) {
  #container { flex-direction:column; }
  #sidebar { 
    position:fixed; bottom:16px; left:16px; width:45vw; max-width:380px; max-height:50vh; 
    background:var(--bg); border-radius:14px; box-shadow:0 6px 20px var(--shadow); 
    padding:14px; overflow-y:auto; transform:translateY(120%); 
    transition:transform .32s cubic-bezier(.4,0,.2,1); z-index:1000; 
    display:block !important; font-size:.94rem; 
  }
  #sidebar.visible { transform:translateY(0); }
  #map { height:100vh !important; }
  #sidebar-logo { max-width:50%; }
  #closeSidebar { display:flex; }
}
@media (max-width:480px) { 
  #sidebar { width:90vw; left:5vw; max-width:none; } 
  #sidebar-logo { max-width:55%; } 
}
}
}
</style>
</head>
<body>
<div id="container">
  <div id="sidebar">
    <button id="closeSidebar">x</button>
    <div id="logo-container">
      <div id="logo-link" style="cursor:pointer;" onclick="resetMapAndSidebar()" title="Reset map">
        <img src="https://realcounties.wordpress.com/wp-content/uploads/2025/06/logo-full-trans-16-6-25.png" alt="Reset Map - Historic Counties" id="sidebar-logo">
      </div>
    </div>
    <h2>Interactive Map</h2>
    <p>Select a county to view details.</p>
    <div id="info" class="loading"><em>Loading counties...</em></div>
    <div id="search-bar">
      <input type="text" id="placeSearch" placeholder="Search for a place...">
      <button id="searchBtn">Search</button>
    </div>
    <div id="searchDropdown" style="position:absolute;background:white;border:1px solid #ccc;max-height:200px;overflow-y:auto;width:calc(100% - 60px);display:none;z-index:1001;margin-top:5px;box-shadow:0 4px 8px rgba(0,0,0,0.1);"></div>
  </div>
  <div id="map"></div>
</div>

<script>
window.onload = function() {
  const sidebar = document.getElementById('sidebar');
  const closeBtn = document.getElementById('closeSidebar');
  const infoDiv = document.getElementById('info');
  const searchInput = document.getElementById('placeSearch');
  const searchDropdown = document.getElementById('searchDropdown');

  // Initialize Leaf map
  const map = L.map('map', { center: [54.5, -3], zoom: 6, minZoom: 5 });
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> | <a href="https://county-borders.co.uk" target="_blank">Historic County Borders Project</a>',
    maxZoom: 19
  }).addTo(map);

  const ukBounds = L.latLngBounds([49.5, -8.5], [60.9, 2.0]);
  map.setMaxBounds(ukBounds);
  map.fitBounds(ukBounds);
  setTimeout(() => map.invalidateSize(), 400);

  // === BRANDED INFO BUTTON (i ICON) ===
  const toggleButton = L.control({ position: 'topright' });
  toggleButton.onAdd = function() {
    const btn = L.DomUtil.create('button', 'leaf-bar leaflet-control');
    btn.innerHTML = 'i';
    btn.title = 'Show county info';
    btn.setAttribute('aria-label', 'Show county info');
    btn.style.cssText = `
      background: #f3e9da;
      color: #9B2C2C;
      border: 1px solid #9B2C2C;
      width: 34px;
      height: 34px;
      font-size: 18px;
      font-weight: bold;
      font-family: Arial, sans-serif;
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: all 0.25s ease;
    `;
    btn.onmouseover = () => {
      btn.style.background = '#9B2C2C';
      btn.style.color = '#f3e9da';
    };
    btn.onmouseout = () => {
      btn.style.background = '#f3e9da';
      btn.style.color = '#9B2C2C';
    };
    btn.onclick = () => sidebar.classList.toggle('visible');
    return btn;
  };
  toggleButton.addTo(map);

  // Reset function
  window.resetMapAndSidebar = function() {
    map.fitBounds(ukBounds);
    infoDiv.innerHTML = '<em>Click a county to explore.</em>';
    if (currentLayer) {
      currentLayer.setStyle({ weight: 1, fillOpacity: 0.35 });
      currentLayer = null;
    }
    if (searchMarker) {
      map.removeLayer(searchMarker);
      searchMarker = null;
    }
    searchInput.value = '';
    searchDropdown.style.display = 'none';
    if (window.innerWidth <= 1024) {
      sidebar.classList.remove('visible');
    }
  };

  // County flags
  const countyFlags = {
    "Aberdeenshire": "https://realcounties.com/wp-content/uploads/2023/11/aberdeenshire-flag.png",
    "Anglesey": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/anglesey.png",
    "Banffshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/10/banffshire-flag-1.jpg",
    "Berkshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/berkshire.png",
    "Berwickshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/berwickshire.png",
    "Buckinghamshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/buckinghamshire.png",
    "Caernarfonshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/caernarfonshire.png",
    "Caithness": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/caithness-flag.png",
    "Cambridgeshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/cambridgeshire.png",
    "Cheshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/cheshire.png",
    "Cornwall": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/cornwall.png",
    "Cumberland": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/cumberland.png",
    "Derbyshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/derbyshire.jpg",
    "Devon": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/devon.jpg",
    "Dorset": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/dorset.jpg",
    "Durham": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/county-durham.png",
    "East Lothian": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/east-lothian-flag.png",
    "Essex": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/essex.jpg",
    "Flintshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/flintshire.png",
    "Glamorgan": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/glamorgan.png",
    "Gloucestershire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/gloucestershire.png",
    "Hampshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/hampshire.png",
    "Herefordshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/herefordshire.png",
    "Hertfordshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/hertfordshire.png",
    "Huntingdonshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/huntingdonshire.png",
    "Kent": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/kent.png",
    "Kirkcudbrightshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/kirkcudbrightshire-flag.png",
    "Lancashire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/lancashire.png",
    "Leicestershire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/leicestershire.png",
    "Lincolnshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/lincolnshire.png",
    "Middlesex": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/middlesex.png",
    "Monmouthshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/monmouthshire.png",
    "Morayshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/10/morayshire-flag-2.jpg",
    "Norfolk": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/norfolk.png",
    "Northamptonshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/northamptonshire.png",
    "Northumberland": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/northumberland.jpg",
    "Nottinghamshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/nottinghamshire.jpg",
    "Orkney": "https://realcounties.wordpress.com/wp-content/uploads/2023/10/orkney-flag.png",
    "Oxfordshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/oxfordshire.png",
    "Pembrokeshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/pembrokeshire.png",
    "Rutland": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/rutland.png",
    "Shetland": "https://realcounties.wordpress.com/wp-content/uploads/2023/10/shetland-flag.png",
    "Shropshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/shropshire.png",
    "Somerset": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/somerset.png",
    "Staffordshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/staffordshire.png",
    "Suffolk": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/suffolk.png",
    "Surrey": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/surrey.png",
    "Sussex": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/sussex.png",
    "Sutherland": "https://realcounties.wordpress.com/wp-content/uploads/2023/10/sutherland-flag.png",
    "Warwickshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/warwickshire.png",
    "Westmorland": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/westmorland.jpg",
    "Wiltshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/wiltshire.png",
    "Worcestershire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/worcestershire.png",
    "Yorkshire": "https://realcounties.wordpress.com/wp-content/uploads/2023/11/yorkshire.jpg"
  };

  async function fetchWeather(lat, lon) {
    try {
      const res = await axios.get(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,wind_speed_10m`);
      const temp = Math.round(res.data.current.temperature_2m);
      const code = res.data.current.weather_code;
      const windKmh = res.data.current.wind_speed_10m;
      const windMph = Math.round(windKmh * 0.621371);
      const descMap = {
        0: 'Clear', 1: 'Mostly clear', 2: 'Partly cloudy', 3: 'Overcast',
        45: 'Fog', 48: 'Fog', 51: 'Light drizzle', 53: 'Drizzle', 55: 'Heavy drizzle',
        61: 'Light rain', 63: 'Rain', 65: 'Heavy rain',
        71: 'Light snow', 73: 'Snow', 75: 'Heavy snow',
        80: 'Showers', 81: 'Rain showers', 82: 'Heavy showers', 95: 'Thunderstorm'
      };
      const desc = descMap[code] || 'Unknown';
      return { temp, desc, wind: windMph };
    } catch (err) {
      console.error("Weather fetch failed:", err);
      return null;
    }
  }
  let subdivisionLayer = null;
  let currentLayer = null;
  let photoTimeout;
  function showPhoto(landmark, e) {
    clearTimeout(photoTimeout);
    const img = document.createElement('img');
    img.src = `https://source.unsplash.com/400x300/?${encodeURIComponent(landmark + ' UK')}`;
    img.style.cssText = 'position:absolute; top:'+(e.clientY+10)+'px; left:'+(e.clientX+10)+'px; width:200px; height:auto; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.3); z-index:10000;';
    img.onload = () => document.body.appendChild(img);
    window.photoImg = img;
  }
  function hidePhoto() {
    photoTimeout = setTimeout(() => {
      if (window.photoImg) { document.body.removeChild(window.photoImg); delete window.photoImg; }
    }, 300);
  }

  // Load county data
  fetch('./counties_simplified8.json')
    .then(res => res.ok ? res.json() : Promise.reject(`Failed: ${res.status}`))
    .then(data => {
      const countyData = {
        "Aberdeenshire": { area: 1950, population: 380495, events: ["Battle of Harlaw (1411)", "Siege of Aberdeen (1646)", "North Sea oil discovered (1960s)"], landmarks: ["Slains Castle", "Balmoral Castle", "Craigievar Castle"], notablePersons: ["John Barbour, author (c.1320-1395)", "James Gregory, mathematician (1638-1675)", "Annie Lennox, singer (1954-present)"] },
        "Anglesey": { area: 277, population: 69751, events: ["Roman invasion repelled (60 AD)", "GlyndÅµr Rebellion (1400-1415)", "Menai Bridge opened (1826)"], landmarks: ["Beaumaris Castle", "South Stack Lighthouse", "Menai Suspension Bridge"], notablePersons: ["Henry Rowlands, antiquarian (1655â€“1723)", "Goronwy Owen, poet (1723â€“1769)", "Dawn French, comedian (1957-present)"] },
        "Angus": { area: 899, population: 264044, events: ["Battle of Nechtansmere (AD 685)", "Battle of Arbroath (1445)", "Birth of Military Aviation (1913)"], landmarks: ["Glamis Castle", "Arbroath Abbey", "Lunan Bay"], notablePersons: ["Hector Boece, historian (c.1465â€“1536)", "J.M. Barrie, author (1860â€“1937)", "Violet Jacob, novelist (1863â€“1946)"] }, 
        "Antrim": { area: 1175, population: 615701, events: ["Titanic built, Belfast (1912)", "Giant's Causeway formed (~60M BC)"], landmarks: ["Giant's Causeway", "Carrickfergus Castle", "Dark Hedges"], notablePersons: ["St Patrick, patron of Ireland (c.385â€“461)", "James McCosh, philosopher (1811â€“1894)", "Liam Neeson, actor (1952â€“present)"] },
        "Argyllshire": { area: 3110, population: 64819, events: ["Iona Abbey founded (563 AD)", "Glencoe Massacre (1692)"], landmarks: ["Iona Abbey", "Inveraray Castle", "Oban Distillery"], notablePersons: ["Duncan Ban MacIntyre, poet (1724â€“1812)", "Neil Munro, author (1863â€“1930)", "John Smith, Labour Leader (1938â€“1994)"] },
        "Armagh": { area: 512, population: 178598, events: ["St. Patrick founds cathedral (445 AD)", "Armagh Observatory (1790)"], landmarks: ["Armagh Cathedral", "Navan Fort", "Armagh Planetarium"], notablePersons: ["Richard Kane, Minorca Governor (1662â€“1736)", "T.R. Robinson, astronomer (1792â€“1882)", "Seamus Heaney, poet (1939â€“2013)"] },
        "Ayrshire": { area: 1129, population: 367676, events: ["Ayr made Royal burgh (1205)", "Battle of Largs (1263)", "Ayr FC founded (1879)"], landmarks: ["Culzean Castle", "Burns Cottage", "Laigh Milton Viaduct"], notablePersons: ["Alexander Peden, preacher (1626â€“1686)", "Robert Burns, poet (1759â€“1796)", "Kris Boyd, footballer (1983-present)"] },
        "Banffshire": { area: 641, population: 46537, events: ["Battle of Mortlach (1010)", "Battle of Glenlivet (1594)", "Banff Bridge built (1779)"], landmarks: ["Duff House", "Balvenie Castle", "Glenfiddich Distillery"], notablePersons: ["James Ferguson, astronomer (1710â€“1776)", "Thomas Edward, naturalist (1814â€“1886)", "James Naughtie, journalist (1951â€“present)"] },
        "Bedfordshire": { area: 468, population: 602847, events: ["Seige of Bedford Castle (1224)", "Bedford Infirmary established (1803)", "Woburn Safari Park (1970)"], landmarks: ["De Grey Mausoleum", "Summeries Castle", "Woburn Abbey"], notablePersons: ["John Bunyan, author (1628â€“1688)", "John Crawley, parliamentarian (1760â€“1836)", "Paul Young, singer (1956â€“present)"] },
        "Berkshire": { area: 722, population: 842804, events: ["Battle of Reading (871)", "Re-Foundation of Abingdon Abbey (1080s)", "Declared Royal County (1957)"], landmarks: ["Ascot Racecourse", "Uffington White Horse", "Windsor Castle"], notablePersons: ["ðŸ‘‘ Alfred the Great (849â€“899)", "Kenneth Grahame, author (1859â€“1932)", "Kate Winslet, actress (1975â€“present)"] },
        "Berwickshire": { area: 457, population: 26458, events: ["Seige of Berwick (1333)", "Duns destroyed (1545)", "Berwickshire Naturalists Club (1831)"], landmarks: ["Duns Castle", "Paxton House", "St Abbâ€™s Head"], notablePersons: ["Duns Scotus, philosopher (c.1266â€“1308)", "David Hume, philosopher (1711â€“1776)", "Thomas McCrae, physician (1870â€“1935)"] },
        "Brecknockshire": { area: 742, population: 67598, events: ["Norman conquest of Brycheiniog (1093)", "Brecknockshire Agricultural Society (1755)", "Brecon & Merthyr Railway (1863)"], landmarks: ["Brecon Beacons", "Brecon Cathedral", "Llangorse Lake"], notablePersons: ["Hywel ap Rhys, prince (c.1270â€“1330)", "Sarah Siddons, actress (1755â€“1831)", "Roger Glover, songwriter (1945â€“present)"] },
        "Buckinghamshire": { area: 746, population: 916903, events: ["Stony Stratford Market (1194)", "Eton College founded (1440)", "Bletchley Park breaks Enigma (1940)"], landmarks: ["Bletchley Park", "Stowe House", "Eton College"], notablePersons: ["John Hampden, parliamentarian (1594â€“1643)", "William Herschel, astronomer (1738â€“1822)", "Roald Dahl, author (1916â€“1990)"] },
        "Buteshire": { area: 225, population: 12534, events: ["Rothesay Castle built (1200s)", "Rothesay Castle destroyed (1685)", "Mount Stuart completed (1879)"], landmarks: ["Rothesay Castle", "Mount Stuart House", "Bute Museum"], notablePersons: ["Ninian Stewart, Lord Treasurer (c.1540â€“1609)", "John Stuart, Prime Minister (1713â€“1792)", "Lena Zavaroni, singer (1963-1999)"] },
        "Caernarfonshire": { area: 563, population: 139065, events: ["Edward I builds castle (1283)", "County established (1284)", "Prince Charles investiture (1969)"], landmarks: ["Caernarfon Castle", "Snowdon", "Llanberis Slate Museum"], notablePersons: ["ðŸ‘‘ Gruffudd ap Cynan (c.1055â€“1137)", "William Morgan, Bible translator (1545â€“1604)", "T.E. Lawrence, L. of Arabia (1888â€“1935)"] },
        "Caithness": { area: 618, population: 26486, events: ["Castle of Old Wick (1159)", "Caithness Grain Riots (1847)", "Dounreay nuclear site (1955)"], landmarks: ["Castle of Mey", "John oâ€™ Groats", "Duncansby Stacks"], notablePersons: ["John o' Groat (legendary, c.1500s)", "Sir John Sinclair, parliamentarian (1754â€“1835)", "Martin Henderson, actor (1974â€“present)"] },
        "Cambridgeshire": { area: 858, population: 460448, events: ["Settled by Angles (6th Century)", "Cambridge University (1209)", "Fens drained (1630s)"], landmarks: ["Kingâ€™s College Chapel", "Ely Cathedral", "Duxford IWM"], notablePersons: ["Thomas Hobson, carrier (1544â€“1631)", "Samuel Pepys, diarist (1633â€“1703)", "Syd Barrett, singer (1946â€“2006)"] },
        "Cardiganshire": { area: 693, population: 75784, events: ["Arrival of Christianity (5th Century)", "Gerard of Wales's journey (1188)", "Aberystwyth University (1872)"], landmarks: ["Devilâ€™s Bridge", "Strata Florida Abbey", "Vale of Rheidol Railway"], notablePersons: ["Dafydd ap Gwilym, poet (c.1315â€“c.1350)", "Edward Richard, educator (1714â€“1777)", "John Davies, historian (1916â€“1990)"] },
        "Carmarthenshire": { area: 937, population: 184232, events: ["County established (1284)", "Owain GlyndÅµr's Rebellion (15thC)", "Rebecca Riots (1839-43)"], landmarks: ["Carreg Cennen Castle", "Laugharne Castle", "National Botanic Garden"], notablePersons: ["Rhys ap Gruffydd, prince (1132â€“1197)", "John Dyer, poet & painter (1699â€“1757)", "Barry John, rugby player (1945-2024)"] },
        "Cheshire": { area: 1035, population: 1668894, events: ["Roman Deva fortress (70 AD)", "Siege of Chester (1644â€“1646)", "Jodrell Bank telescope (1957)"], landmarks: ["Beeston Castle", "Chester Cathedral", "Dunham Massey"], notablePersons: ["John Bradshaw, judge (1602â€“1659)", "Lewis Carroll, author (1832â€“1898)", "Patricia Routledge, actress (1929-2025)"] },
        "Clackmannanshire": { area: 48, population: 50957, events: ["Clackmannan Tolbooth (1592)", "Kirkyard Riot (1858)", "Devon Colliery Tragedy (1897)"], landmarks: ["Alloa Tower", "Castle Campbell", "Dollar Glen"], notablePersons: ["Sir William Bruce, architect (c.1630â€“1710)", "James Bruce, explorer (1730â€“1794)", "Jackie Bird, journalist (1962â€“present)"] },
        "Cornwall": { area: 1365, population: 533594, events: ["Mining begins (2150BC)", "Kingdom of Cornwall emerges (500)", "Romans take Cornwall (after 43AD)"], landmarks: ["St Michaelâ€™s Mount", "Eden Project", "Tintagel Castle"], notablePersons: ["John Trehenban, rebel (c.1500â€“1570)", "Richard Trevithick, inventor (1771â€“1833)", "Kristin Scott Thomas, actress (1960â€“present)"] },
        "Cromartyshire": { area: 370, population: 7074, events: ["Established as sherrifdom (12thC)", "Mackenzies purchase feudal Barony (1682)", "Hugh Miller fossils (1820s)"], landmarks: ["Cromarty Courthouse", "Hugh Millerâ€™s Cottage", "Ben More Coigach"], notablePersons: ["Sir Thomas Urquhart, writer (1611â€“1660)", "George Mackenzie, Earl of Cromartie (1630-1714)", "Hugh Miller, geologist (1802â€“1856)"] },
        "Cumberland": { area: 1525, population: 306241, events: ["Prehistoric settlement (12,000BC)", "Ceded to Scotland (945AD)", "County established (12thC)"], landmarks: ["Carlisle Castle", "Hadrianâ€™s Wall", "Scafell Pike"], notablePersons: ["Robert de Eglesfield, founder of Queen's College Oxford (c.1295â€“1349)", "William Wordsworth, poet (1770â€“1850)", "Bill Shankly, football manager (1913-present)"] },
        "Denbighshire": { area: 668, population: 227680, events: ["Denbigh Castle built (1282)", "Royalist stronghold (1642-1651)", "Llyn Brenig Reservoir (1970)"], landmarks: ["Denbigh Castle", "Pontcysyllte Aqueduct", "Llangollen Railway"], notablePersons: ["Owain GlyndÅµr, prince (c.1359â€“c.1415)", "Henry Stanley, explorer (1841â€“1904)", "Ian Rush, footballer (1961â€“present)"] },
        "Derbyshire": { area: 1017, population: 1148373, events: ["Derby established (807AD)", "County first mentioned (1048)", "Rolls Royce in Derby (1907)"], landmarks: ["Blue John Mines", "Chatsworth House", "Peak District National Park"], notablePersons: ["Anthony Babington, plotter (1561â€“1586)", "Joseph Wright, painter (1734â€“1797)", "Alison Lapper, artist (1965â€“present)"] },
        "Devon": { area: 2621, population: 1133463, events: ["Roman Conquest (43AD)", "Viking Raids (9thC)", "Plymouth naval base (1691)"], landmarks: ["Dartmoor", "Exeter Cathedral", "Jurassic Coast"], notablePersons: ["Francis Drake, circumnavigator (c.1540â€“1596)", "Charles Babbage, inventor (1791â€“1871)", "Agatha Christie, crime novelist (1890â€“1976)"] },
        "Dorset": { area: 1005, population: 543296, events: ["Neolithic Settlements (12,500BC)", "Black Death (1348)", "D-Day Landings (1944)"], landmarks: ["Cerne Abbas Giant", "Durdlestone Head", "Lulworth Cove"], notablePersons: ["Giles Daubeney, Lord Chamberlain (1451â€“1508)", "Mary Anning, fossil hunter (1799â€“1847)", "John le CarrÃ©, spy novelist (1931â€“2020)"] },
        "Down": { area: 950, population: 528983, events: ["Fiatach Rule (400 AD)", "St. Patrick's Arrival (432 AD)", "Norman Conquest (1177)"], landmarks: ["Downpatrick Cathedral", "Mourne Mountains", "Scrabo Tower"], notablePersons: ["Sir Hans Sloane, naturalist (1660â€“1753)", "C.S. Lewis, author (1898â€“1963)", "Rory McIlroy, golfer (1989â€“present)"] },
        "Dumfriesshire": { area: 1063, population: 77160, events: ["Dumfries established (1180)", "Rise of Castles (15-17thC)", "Pan Am Flight 103 bomb (1988)"], landmarks: ["Caerlaverock Castle", "Crawick Multiverse", "Devorgilla Bridge"], notablePersons: ["William Paterson, founder of the Bank of England (1658â€“1719)", "Thomas Carlyle, historian (1795â€“1881)", "David McKail, actor (1938â€“present)"] },
        "Dunbartonshire": { area: 241, population: 262419, events: ["Viking siege of Dumbarton (870)", "Dumbarton Castle captured (1305)", "Helensburgh becomes Burgh of Barony (1807)"], landmarks: ["Dumbarton Castle", "Hill House", "Loch Lomond"], notablePersons: ["George Buchanan, humanist scholar (1506â€“1582)", "Tobias Smollett, novelist (1721â€“1771)", "John Logie Baird, inventor of TV (1888â€“1946)"] },
        "Durham": { area: 1022, population: 1467037, events: ["Durham Cathedral founded (1093)", "Durham miners strike (1831)", "Beamish Museum opens (1970)"], landmarks: ["Barnard Castle", "Durham Cathedral", "Tanfield Railway"], notablePersons: ["Bede, English History (c.673â€“735)", "George Stephenson, railways (1781â€“1848)", "Rowan Atkinson, comedian (1955â€“present)"] },
        "East Lothian": { area: 267, population: 74882, events: ["Capture of Dunbar Castle (1296)", "Battle of Prestonpans (1745)", "Luftwaffe Raids (1940)"], landmarks: ["Bass Rock", "Dirleton Castle", "Tantallon Castle"], notablePersons: ["John Knox, Protestant reformer (c.1514â€“1572)", "John Muir, conservationist (1838â€“1914)", "John Bellany (1942â€“2013)"] },
        "Essex": { area: 1591, population: 2999248, events: ["Formation of the Kingdom of Essex (c.527)", "Marian Persecutions (1555-58)", "Southend Pier opens (1830)"], landmarks: ["Audley End House", "Colchester Castle", "Southend Pier"], notablePersons: ["John Ball, led peasants revolt (c.1338â€“1381)", "Anne Knight, suffragist (1786â€“1862)", "Jamie Oliver, chef (1975â€“present)"] },
        "Fermanagh": { area: 715, population: 61170, events: ["Kingdom of Fermanagh (c.900-1200)", "Flight of the Earls (1607)", "Battle of the Ford of the Biscuits (1594)"], landmarks: ["Enniskillen Castle", "Devenish Island", "Marble Arch Caves"], notablePersons: ["John Armstrong, soldier & poet (1674â€“1742)", "William Archdall, antiquary (1761â€“1834)", "Gordon Wilson, peace advocate (1927â€“1995)"] },
        "Fife": { area: 504, population: 365493, events: ["Kingdom of Fife (c.500-900)", "Dunfermline Abbey founded (1070s)", "St Andrews University founded (1413)"], landmarks: ["Culross Palace", "Falkland Palace", "St Andrew's Cathedral"], notablePersons: ["Robert Henryson, makar poet (c.1425â€“1500)", "Adam Smith, economist (1723â€“1790)", "Ian Rankin, crime writer (1960â€“present)"] },
        "Flintshire": { area: 260, population: 215390, events: ["Flint Castle built (1277)", "Capture of Richard II (1399)", "Shotton Steelworks (1916)"], landmarks: ["Flint Castle", "St Winifredâ€™s Well", "Basingwerk Abbey"], notablePersons: ["Thomas Pennant, naturalist (1726â€“1798)", "Daniel Owen, Welsh novelist (1836â€“1895)", "Gary Speed, footballer (1969â€“2011)"] },
        "Glamorgan": { area: 827, population: 1321460, events: ["Kingdom of Morgannwg (c.400-1000)", "Glamorganshire Canal (1794)", "Castell Coch rebuilt (1870s)"], landmarks: ["Cardiff Castle", "Castell Coch", "National Museum Cardiff"], notablePersons: ["ðŸ‘‘ Iestyn ap Gwrgant (c.1081â€“1093)", "Roald Dahl, author (1916â€“1990)", "Anthony Hopkins, actor (1937â€“present)"] },
        "Gloucestershire": { area: 1293, population: 1147106, events: ["Gloucester / Glevum founded (97AD)", "Death of Edward II (1327)", "Siege of Gloucester (1643)"], landmarks: ["Berkeley Castle", "Cotswold Way", "Gloucester Cathedral"], notablePersons: ["William Tyndale, translator (c.1494â€“1536)", "Edward Jenner, vaccine pioneer (1749â€“1823)", "Simon Pegg, actor (1970â€“present)"] },
        "Hampshire": { area: 1656, population: 2099640, events: ["Winchester Cathedral begun (1079)", "King Charles I imprisoned (1647)", "Jane Austen's death (1817)"], landmarks: ["New Forest National Park", "Osborne House (Isle of Wight)", "Portsmouth Dockyard"], notablePersons: ["William of Wykeham, Winchester College founder (1324â€“1404)", "Jane Austen, novelist (1775â€“1817)", "Charles Dickens, novelist (1812â€“1870)"] },
        "Herefordshire": { area: 837, population: 183631, events: ["Anglo-Saxon Settlement (5-6thC)", "Hereford & Gloucester Canal (1798)", "Agricultural innovation (1850s)"], landmarks: ["Berrington Hall", "Hereford Castle (ruins)", "Ledbury Market House"], notablePersons: ["Roger de Breteuil, rebel (c.1050â€“after 1087)", "David Garrick, actor (1717â€“1779)", "Ellie Goulding (1986â€“present)"] },
        "Hertfordshire": { area: 633, population: 1157166, events: ["Verulamium founded (50 AD)", "Siege of Hertford Castle (1216)", "Warner Bros. Studio opens (2012)"], landmarks: ["St Albans Cathedral", "Hatfield House", "Knebworth House"], notablePersons: ["Nicholas Breakspear, Pope Adrian IV (c.1100â€“1159)", "H.G. Wells, sci-fi writer (1866â€“1946)", "Vinnie Jones, footballer/actor (1965â€“present)"] },
        "Huntingdonshire": { area: 366, population: 211776, events: ["Huntingdon made royal borough (c.974)", "Cromwell born (1599)", "Arrival of Great Northern Railway (1840s)"], landmarks: ["Grafham Water SSSI", "Hinchingbrooke House", "Ramsey Abbey Gatehouse"], notablePersons: ["Henry of Huntingdon, historian (c.1088â€“1157)", "Oliver Cromwell, Lord Protector (1599â€“1658)", "David Howarth, historian (1912â€“1991)"] },
        "Inverness-shire": { area: 4211, population: 118077, events: ["Rise of Clan System (11-12thC)", "Battle of Culloden (1746)", "Loch Ness Monster reported (1933)"], landmarks: ["Caledonian Canal", "Loch Ness", "Urquhart Castle"], notablePersons: ["James Macpherson, translator (1736â€“1796)", "Flora MacDonald, Jacobite heroine (1722â€“1790)", "Ali Smith, novelist (1962â€“present)"] },
        "Kent": { area: 1611, population: 2747715, events: ["Christianisation (597)", "Dover Castle built (1180s)", "Hundred Yearsâ€™ War (1337â€“1453)"], landmarks: ["Canterbury Cathedral", "Leeds Castle", "White Cliffs of Dover"], notablePersons: ["William Caxton, printer (c.1422â€“1491)", "Christopher Marlowe, playwright (1564â€“1593)", "Mick Jagger, singer (1943â€“present)"] },
        "Kincardineshire": { area: 380, population: 77670, events: ["Norse Raids (9-11thC)", "Dunnottar Castle siege (1651)", "Expansion of Stonehaven Harbour (1820s)"], landmarks: ["Cowie Castle (ruins)", "Dunnottar Castle", "Stonehaven Tolbooth Museum"], notablePersons: ["John Mair, philosopher (1467â€“1550)", "James Beattie, poet (1735â€“1803)", "David Foggie, portrait painter (1878â€“1948)"] },
        "Kinross-shire": { area: 73, population: 11223, events: ["Pictish & early Scottish rule (9-11thC)", "Mary Queen of Scots imprisoned (1567)", "Arrival of railways (19thC)"], landmarks: ["Kinross House", "Loch Leven Castle", "RSPB Loch Leven"], notablePersons: ["Patrick Simson, theologian (c. 1556â€“1618)", "Michael Bruce, poet (1746â€“1767)", "Douglas Young, Scots poet (1913â€“1973)"] },
        "Kirkcudbrightshire": { area: 899, population: 47546, events: ["Part of the Lordship of Galloway (12thC)", "Covenanter movement (1638â€“1651)", "Growth in tourism (20thC)"], landmarks: ["Broughton House", "Dundrennan Abbey", "Threave Castle"], notablePersons: ["Sir John Dalrymple, 1st Baronet of Stair (c. 1650 â€“ 1721)", "S.R. Crockett, author (1859â€“1914)", "Malcolm Caldwell, academic (1931â€“1978)"] },
        "Lanarkshire": { area: 879, population: 1008014, events: ["Developed as feudal county (12-13thC)", "Battle of Lanark (1297)", "Covenanter period (1638â€“1651)"], landmarks: ["Lanark Castle (ruins)", "Hamilton Mausoleum", "Falls of Clyde"], notablePersons: ["James Hamilton, assassin (c. 1530â€¯â€“â€¯1578)", "David Livingstone, explorer (1813â€“1873)", "R.D. Laing, psychaiatrist (1927â€“1989)"] },
        "Lancashire": { area: 1909, population: 4942364, events: ["Established as county (1182)", "Scottish Raid & Burning of Lancaster (1322)", "Pendle Witch Trials (1612)", "Peterloo Massacre (1819)"], landmarks: ["Lancaster Castle", "Blackpool Tower", "Royal Albert Dock"], notablePersons: ["Roger of Poitou, founded Lancaster (c.1065â€“c.1140)", "George Formby, entertainer (1875â€“1921)", "Paul McCartney, musician (1942â€“present)"] },
        "Leicestershire": { area: 836, population: 975403, events: ["Ratae Corieltauvorum (Leicester) Roman town", "Battle of Bosworth (1485)", "Chartist movement (1830s/40s)"], landmarks: ["Belvoir Castle", "Bosworth Battlefield Heritage Centre", "National Space Centre"], notablePersons: ["Simon de Montfort, Baronial reformer (c.1208â€“1265)", "Thomas Cook, tourism (1808â€“1892)", "Gary Lineker, footballer (1960â€“present)"] },
        "Lincolnshire": { area: 2687, population: 1038510, events: ["Part of Lindsey then Mercia Kingdoms (5-11thC)", "Second Battle of Lincoln (1217)", "Lincolnshire Uprising (1470s)"], landmarks: ["Lincoln Cathedral", "Tattershall Castle", "Theddlethorpe Dunes"], notablePersons: ["Hereward the Wake, outlaw (c.1035â€“c.1072)", "Isaac Newton, physicist (1643â€“1727)", "Margaret Thatcher, first female PM (1925â€“2013)"] },
        "Londonderry": { area: 816, population: 247971, events: ["City walls built (1613)", "Siege of Derry (1689)", "Peace Bridge opens (2011)"], landmarks: ["Derry City Walls", "Guildhall", "Peace Bridge"], notablePersons: ["Sir Randal Beresford, Baronet (c.1636-1681)", "Charles Thomson, US patriot leader (1729â€“1824)", "James Chichesterâ€‘Clark, PM of NI (1923â€“2002)"] },
        "Merionethshire": { area: 676, population: 37874, events: ["Castell y Bere captured (13thC)", "GlyndÅµr parliament (1404)", "Ffestiniog Railway (1836)"], landmarks: ["Cader Idris", "Harlech Castle", "Portmeirion Village"], notablePersons: ["Ellis Wynne, author (1671â€“1734)", "Richard Roberts, inventor (1789â€“1864)", "Bob Roberts, folk singer (1907â€“1982)"] },
        "Middlesex": { area: 285, population: 4000927, events: ["The Battle of Brentford (c.1016)", "Charterhouse founded (1371)", "Middlesex Regiment formed (1881)"], landmarks: ["Palace of Westminster", "Wrotham Park", "Wembley Stadium"], notablePersons: ["Geoffrey Chaucer, writer (c.1343â€“1400)", "John Keats, poet (1795â€“1821)", "Amy Winehouse, singer (1983â€“2011)"] },
        "Midlothian": { area: 362, population: 621610, events: ["Viking raids (9th-10th centuries)", "Battle of Roslin (1303)", "Musselburgh Racecourse founded (1816)"], landmarks: ["Edinburgh Castle", "Rosslyn Chapel", "Newbattle Abbey"], notablePersons: ["ðŸ‘‘ James VI of Scotland (1566â€¯â€“â€¯1625)", "Walter Scott, novelist (1771â€“1832)", "Tam Dalyell, parliamentarian (1932â€“2017)"] },
        "Monmouthshire": { area: 542, population: 514723, events: ["Owain GlyndÅµr rebellion (1400-15)", "Chartist March (1839)", "Big Pit Coal Museum (1983)"], landmarks: ["Big Pit: National Coal Museum", "Raglan Castle", "Tintern Abbey"], notablePersons: ["Geoffrey of Monmouth, chronicler (c.1095â€“1155)", "ðŸ‘‘ Henry V (1386â€“1422)", "Desmond Llewelyn, actor (1914â€“1999)"] },
        "Montgomeryshire": { area: 796, population: 61956, events: ["Montgomery Castle (12thC)", "Dolforwyn Castle (13thC)", "Lake Vyrnwy Dam (1880s)"], landmarks: ["Montgomery Castle", "Montgomeryshire Canal", "Powis Castle"], notablePersons: ["Dafydd Nanmor, bard (c.1420â€“c.1490)", "Robert Owen, co-op founder (1771â€“1858)", "Robert William Griffiths, farmer (1896â€“1962)"] },
        "Morayshire": { area: 476, population: 67654, events: ["Elgin Cathedral founded (1224)", "Jacobite risings (1689â€“1746)", "Glen Moray Distillery (1897)"], landmarks: ["Duffus Castle", "Elgin Cathedral", "Pluscarden Abbey"], notablePersons: ["Alexander Brodie, diarist (1617â€“1680)", "James Grant, novelist (1802â€“1879)", "Kenneth Mackessack, cricketer (1902â€“1982)"] },
        "Nairnshire": { area: 200, population: 13894, events: ["Cawdor Castle built (1300s)", "Clan disputes & raids (16thâ€“17thC)", "Nairn Golf Club founded (1887)"], landmarks: ["Cawdor Castle", "Nairn Museum", "Nairn / Culloden Viaduct"], notablePersons: ["James Brodie, botanist (1744â€“1824)", "Hugh Rose, 15th Baron Kilravock (1663â€“1732)", "James Campbell, potter (1943â€“2019)"] },
        "Norfolk": { area: 2057, population: 807721, events: ["Boudicaâ€™s Revolt (c.60AD)", "Norwich Castle built (1067)", "Railway expansion (19thC)"], landmarks: ["Norwich Cathedral", "Sandringham House", "Holkham Hall"], notablePersons: ["Julian of Norwich, mystic (c.1342â€“c.1416)", "Horatio Nelson, naval hero (1758â€“1805)", "Edith Cavell, WWI nurse (1865â€“1915)"] },
        "Northamptonshire": { area: 998, population: 838786, events: ["Trial of Simon de Montfortâ€™s supporters (1264)", "Battle of Northampton (1460)", "Battle of Naseby (1645)"], landmarks: ["Althorp", "Fotheringhay Castle", "Rockingham Castle"], notablePersons: ["Simon de Senlis, Norman Earl (c.1098â€“1153)", "John Dryden, Poet Laureate (1631â€“1700)", "Alan Moore, comic writer (1953â€“present)"] },
        "Northumberland": { area: 2019, population: 797006, events: ["Roman occupation (c.70â€“410 AD)", "Battle of Heavenfield (c.634)", "Battle of Flodden Field (1513)"], landmarks: ["Hadrianâ€™s Wall", "Alnwick Castle", "Lindisfarne"], notablePersons: ["Henry 'Hotspur' Percy, rebel (1364â€“1403)", "Grace Darling, rescue heroine (1815â€“1842)", "Sting (1951â€“present)"] },
        "Nottinghamshire": { area: 843, population: 1096617, events: ["Siege of Nottingham (1016)", "Battle of Stoke Field (1487)", "Nottingham Canal (1796)"], landmarks: ["Sherwood Forest", "Nottingham Castle", "Wollaton Hall"], notablePersons: ["Robin Hood, folk hero (c.1190)", "William Booth, Salvation Army (1829â€“1912)", "D.H. Lawrence, author (1885â€“1930)"] },
        "Orkney": { area: 376, population: 21349, events: ["Neolithic settlement (c.4000â€“2500 BC)", "Annexation to Scotland (1472)", "Scapa Flow scuttling (1919)"], landmarks: ["Ring of Brodgar", "Skara Brae", "St Magnus Cathedral"], notablePersons: ["William Elphinstone, Aberdeen University founder (1431â€“1514)", "Edwin Muir, novelist (1887â€“1959)", "George Mackay Brown, poet (1921â€“1996)"] },
        "Oxfordshire": { area: 754, population: 512345, events: ["Oxford University founded (1096)", "Siege of Oxford (1646)", "Mini car production (1959-2000)"], landmarks: ["Oxford Colleges", "Blenheim Palace", "Christ Church Cathedral"], notablePersons: ["William Lenthall, HoC Speaker (1591â€“1662)", "Warren Hastings, India Gov-Gen (1732â€“1818)", "Winston Churchill, PM (1874â€“1965)"] },
        "Peeblesshire": { area: 548, population: 19074, events: ["Traquair House oldest (1107)", "Wars of Scottish Independence (1296â€“1357)", "Dawyck Botanic Garden (1600s)"], landmarks: ["Dawyck Botanic Garden", "Neidpath Castle", "Traquair House"], notablePersons: ["Sir David Murray (c.1599â€“1653)", "William Chambers, publisher (1800â€“1883)", "John Buchan, author (1875â€“1940)"] },
        "Pembrokeshire": { area: 625, population: 122122, events: ["St Davids Cathedral (1181)", "Flemish settlement (12-13thC)", "Coast Path (1970)"], landmarks: ["St Davids Cathedral", "Pembroke Castle", "Skomer Island"], notablePersons: ["Asser, bishop & biographer (d. 909)", "Henry Tudor, Henry VII (1457â€“1509)", "Christian Bale, actor (1974â€“present)"] },
        "Perthshire": { area: 2493, population: 156371, events: ["Scone Palace: Stone of Destiny (800s)", "Perth made royal burgh (12-13thC)", "Tay Bridge collapse (1879)"], landmarks: ["Blair Castle", "Loch Tay", "Scone Palace"], notablePersons: ["Neil Gow, musician (1727â€“1807)", "William Soutar, poet (1898â€“1943)", "Alan Cumming, actor (1965-present)"] },
        "Radnorshire": { area: 470, population: 25821, events: ["Roman occupation (1st-4thC)", "Norman invasion (late 11thC)", "Turnpike roads then railways (19thC"], landmarks: ["Cefnllys Castle", "Radnor Forest", "Llandrindod Wells"], notablePersons: ["Thomas Huet, poet (d. 1591)", "John Price, soldier & antiquary (1600â€“1676)", "David Jones, poet & artist (1895â€“1974)"] },
        "Renfrewshire": { area: 245, population: 508064, events: ["Paisley Abbey founded (1163)", "Paisley pattern created (18thC)", "Renfrew Airport opens (1918)"], landmarks: ["Castle Semple", "Coats Observatory", "Paisley Abbey"], notablePersons: ["Robert Tannahill, weaver poet (1774â€“1810)", "James Watt, inventor (1736â€“1819)", "Lena Zavaroni, singer (1963â€¯â€“â€¯1999)"] },
        "Ross-shire": { area: 3089, population: 69503, events: ["Arrival of St. Maelrubha (673)", "Christianisation of the Picts (7thâ€“9th centuries)", "Inverness & Ross-shire Railway (1860s)"], landmarks: ["Eilean Donan Castle", "Falls of Measach", "Fortrose Cathedral"], notablePersons: ["Sir George Munro, soldier (1685 â€“ 1746)", "Sir Hector Mackenzie, clan chief (1758â€¯â€“â€¯1826)", "Francis Charles Fraser, zoologist (1903 â€“ 1978)"] },
        "Roxburghshire": { area: 666, population: 50800, events: ["ðŸ‘‘ Death of James II (1460)", "Covenanter movement (1638â€“1651)", "Waverley Railway Line (1849â€“1862)"], landmarks: ["Bowmont Water Valley", "Jedburgh Abbey", "Roxburgh Castle"], notablePersons: ["Robert Ker, Earl of Roxburghe (c. 1570 â€“ 1650)", "John Leyden, orientalist (1775â€“1811)", "Thomas Pringle, anti-slavery poet (1789â€“1834)"] },
        "Rutland": { area: 152, population: 37677, events: ["Granted to Norman lords (>1066)", "Railways reached Oakham (1840s)", "Rutland Water created (1976)"], landmarks: ["Oakham Castle", "Rutland Railway Museum", "St Maryâ€™s Church (Tickencote)"], notablePersons: ["William de Ros, signed Magna Carta (c.1255â€“1316)", "Thomas Barker, meteorologist (1769â€“1847)", "Richard Condon, cricketer (1937â€“1991)"] },
        "Selkirkshire": { area: 267, population: 16010, events: ["Ettrick Medieval Royal Forest (from 12thC)", "Lawless Border Reivers (15th-16thC)", "Battle of Philiphaugh (1645)"], landmarks: ["Bowhill House", "Selkirk Town Hall", "Yair Bridge"], notablePersons: ["James Hogg, novelist (1770â€“1835)", "Andrew Currie, sculptor (1812â€“1891)", "Walter Greive, cricketer (1891â€“1917)"] },
        "Shetland": { area: 551, population: 23167, events: ["Norse Settlement (c.800â€“900AD)", "Transfer to Scotland (1469)", "Rise of Fishing Industry (19thC)"], landmarks: ["Jarlshof", "Noss National Nature Reserve", "Scalloway Castle"], notablePersons: ["Patrick Stewart, Earl of Orkney (c. 1566â€“1615)", "Arthur Anderson, P&O founder (1792â€“1868)", "Christine De Luca, poet (1947â€“present)"] },
        "Shropshire": { area: 1342, population: 472027, events: ["Battle of Maserfield (642 AD)", "Battle of Shrewsbury (1403)", "Birth of Industrial Revolution, Ironbridge (1709)"], landmarks: ["Ironbridge Gorge", "Shrewsbury Castle", "Wrekin Hill"], notablePersons: ["Orderic Vitalis, chronicler (1075â€“c.1142)", "Charles Darwin, naturalist (1809â€“1882)", "Wilfred Owen, WWI poet (1893â€“1918)"] },
        "Somerset": { area: 1633, population: 1053504, events: ["Battle of Peonnum (658)", "Battle of Sedgemoor (1685)", "Somerset Levels Drained (18th-19thC)"], landmarks: ["Cheddar Gorge", "Glastonbury Abbey", "Wells Cathedral"], notablePersons: ["Joseph of Glastonbury, Arthurian Legend chronicler (c.1360â€“c.1420)", "Samuel Taylor Coleridge, poet (1772â€“1834)", "John Cleese, comedian (1939â€“present)"] },
        "Staffordshire": { area: 1176, population: 2159392, events: ["Stafford castle built (c.1085)", "Lichfield Cathedral consecrated (1195)", "Rise of the Potteries (18thC)"], landmarks: ["Alton Towers", "Lichfield Cathedral", "Trentham Estate"], notablePersons: ["Izaak Walton, author (1593â€“1683)", "Josiah Wedgwood, industrialist (1730â€“1795)", "Lemmy Kilmister, musician (1945â€“2015)"] },
        "Stirlingshire": { area: 447, population: 244092, events: ["Battle of Bannockburn (1314)", "Jacobite Rising (1715)", "Forth & Clyde Canal opens (1790)"], landmarks: ["Bannockburn Battlefield", "River Forth", "Stirling Castle"], notablePersons: ["James Bruce of Kinnaird, laird (1610â€“1680)", "James Bruce of Kinnaird, explorer (1730â€“1794)", "Billy Bremner, footballer (1942â€“1997"] },
        "Suffolk": { area: 1505, population: 775099, events: ["Foundation of Bury St Edmunds Abbey (1020)", "Battle of Leiston (1217)", "Ipswich & Felixstowe Port Development (19thC)"], landmarks: ["Framlingham Castle", "Southwold Lighthouse", "Suffolk Coast & Heaths AONB"], notablePersons: ["Thomas Cavendish, navigator (1560â€“1592)", "Thomas Gainsborough, painter (1727â€“1788)", "Benjamin Britten, composer (1913â€“1976)"] },
        "Surrey": { area: 759, population: 2975836, events: ["Battle of Aclea (c. 825)", "Magna Carta at Runnymede (1215)", "Brooklands racetrack opens (1907)"], landmarks: ["Brooklands Museum", "Gatwick Airport", "Waverley Abbey (ruins)"], notablePersons: ["Sir William Perkins, merchant (1631 â€“ 1696)", "Aldous Huxley, author (1894â€“1963)", "Eric Clapton, guitarist (1945â€“present)"] },
        "Sussex": { area: 1466, population: 1612454, events: ["Battle of Hastings (1066)", "Siege of Lewes (1264)", "Railways spur seaside tourism (19thC)"], landmarks: ["Arundel Castle", "Battle Abbey", "Brighton Royal Pavilion"], notablePersons: ["John Selden, scholar (1584 â€“ 1654)", "Gideon Mantell, paleontologist (1790â€“1852)", "Peter James, crime novelist (1948â€“present)"] },
        "Sutherland": { area: 2028, population: 12803, events: ["Norse Influence (8thâ€“13th centuries)", "Clan Conflicts (13thâ€“16th centuries)", "Highland Clearances (18th-19thC)"], landmarks: ["Dornoch Cathedral", "Dunrobin Castle", "Loch Shin"], notablePersons: ["Robert Gordon, historian (1635â€¯â€“â€¯1695)", "Hugh Mackay, military officer (c. 1740â€“1800)", "Alistair, 25th Earl of Sutherland (1947-present)"] },
        "Tyrone": { area: 1260, population: 178440, events: ["Norman Invasion & Gaelic Lords (12thâ€“13th centuries)", "Battle of the Yellow Ford (1598)", "Penal Laws & Religious Tensions (18th-19thC)"], landmarks: ["Dungannon Castle", "Omagh Cathedral", "Gortin Glen Forest Park"], notablePersons: ["Turlough Luineach Oâ€™Neill, noble (c.1530â€“1595)", "John Dunlap, printed US DoI (1747â€“1822)", "Brian Friel, dramatist (1929â€“2015)"] },
        "Warwickshire": { area: 918, population: 1632885, events: ["Foundation of Warwick Castle (1068)", "Shakespeare born (1564)", "Coventry Blitz (1940)"], landmarks: ["Coventry Cathedral", "Jephson Gardens", "Kenilworth Castle"], notablePersons: ["Guy of Warwick, legendary knight (c.930)", "William Shakespeare, playwright (1564â€“1616)", "George Eliot, novelist (1819â€“1880)"] },
        "West Lothian": { area: 120, population: 154830, events: ["Battle of Linlithgow Bridge (1526)", "Covenanter activity (1640s)", "Oil Shale Industry (19thâ€“20th centuries)"], landmarks: ["Bathgate Oil Shale Works", "Beecraigs Country Park", "Linlithgow Palace"], notablePersons: ["Mary, Queen of Scots (1542â€“1587)", "Sir James Simpson, obstetrician (1811â€“1870)", "Susan Boyle, singer (1961â€“present)"] },
        "Westmorland": { area: 785, population: 87466, events: ["Construction of Appleby Castle (12thC)", "Kendal Green cloth production (17th-18thC)", "Kendal to Lancaster Canal built (18thC)"], landmarks: ["Kendal Castle", "Levens Hall", "Rydal Mount"], notablePersons: ["Lancelot de Threlkeld, knight (c.1435â€“1493)", "John Gough, natural philosopher (1757 â€“ 1825)", "Helen Skelton, TV presenter (1983â€“present)"] },
        "Wigtownshire": { area: 487, population: 26618, events: ["Norse Influence (8thâ€“12th centuries)", "Wigtown Martyrs (1685)", "Portpatrick & Wigtownshire Railway (19thC)"], landmarks: ["Castle Kennedy", "Mull of Galloway Lighthouse", "Whithorn Priory"], notablePersons: ["Margaret Wilson, covenanter martyr (c.â€¯1667â€“1685)", "Sir Herbert Maxwell, 7th Baronet (1845-1937)", "Graeme Parker, YouTuber (1982-present)"] },
        "Wiltshire": { area: 1374, population: 682380, events: ["Stonehenge built (c.3000 BC)", "Roman Occupation (1stâ€“5th centuries)", "Salisbury Cathedral (1220)"], landmarks: ["Avebury", "Salisbury Cathedral", "Stonehenge"], notablePersons: ["Ã†thelweard, chronicler (c.940â€“998)", "Christopher Wren, architect (1632â€“1723)", "John Rhys-Davies, actor (1944-present)"] },
        "Worcestershire": { area: 709, population: 1125037, events: ["Foundation of Worcester Cathedral (7thC)", "Battle of Worcester (1651)", "Canal Construction (18th century)"], landmarks: ["Malvern Hills", "Worcester & Birmingham Canal", "Worcester Cathedral"], notablePersons: ["Edward Winslow, Pilgrim leader (1595â€“1655)", "Jenny Lind, opera singer (1820â€“1887)", "Edward Elgar, composer (1857â€“1934)"] },
        "Yorkshire": { area: 6081, population: 5218838, events: ["Roman Conquest (43â€“410)", "Norse Kingdom of JÃ³rvÃ­k (9th-10thC)", "Siege of York (1644)"], landmarks: ["Fountains Abbey, West Riding", "Hull Docks, East Riding", "York Minster, York within the Walls"], notablePersons: ["Alcuin of York, scholar (c.735â€“804)", "Charlotte BrontÃ«, novelist (1816â€“1855)", "J.B. Priestley, writer (1894â€“1984)"] }
      };

      const countyLanguages = {
        "Anglesey": { name: "Sir FÃ´n", lang: "Welsh" },
        "Brecknockshire": { name: "Sir Frycheiniog", lang: "Welsh" },
        "Caernarfonshire": { name: "Sir Gaernarfon", lang: "Welsh" },
        "Cardiganshire": { name: "Sir Aberteifi / Ceredigion", lang: "Welsh" },
        "Carmarthenshire": { name: "Sir Gaerfyrddin", lang: "Welsh" },
        "Denbighshire": { name: "Sir Ddinbych", lang: "Welsh" },
        "Flintshire": { name: "Sir y Fflint", lang: "Welsh" },
        "Glamorgan": { name: "Morgannwg", lang: "Welsh" },
        "Merionethshire": { name: "Meirionnydd", lang: "Welsh" },
        "Monmouthshire": { name: "Sir Fynwy", lang: "Welsh" },
        "Montgomeryshire": { name: "Sir Drefaldwyn", lang: "Welsh" },
        "Pembrokeshire": { name: "Sir Benfro", lang: "Welsh" },
        "Radnorshire": { name: "Sir Faesyfed", lang: "Welsh" },
        "Aberdeenshire": { name: "Siorrachd Obar Dheathain", lang: "Scottish Gaelic" },
        "Angus": { name: "Aonghas", lang: "Scottish Gaelic" },
        "Argyllshire": { name: "Siorrachd Earra-GhÃ idheal", lang: "Scottish Gaelic" },
        "Ayrshire": { name: "Siorrachd Inbhir Ã€ir", lang: "Scottish Gaelic" },
        "Banffshire": { name: "Siorrachd Bhanbh", lang: "Scottish Gaelic" },
        "Berwickshire": { name: "Siorrachd Bhearaig", lang: "Scottish Gaelic" },
        "Buteshire": { name: "Siorrachd BhÃ¹th", lang: "Scottish Gaelic" },
        "Caithness": { name: "Gallaibh", lang: "Scottish Gaelic" },
        "Clackmannanshire": { name: "Siorrachd Chlach Mhanainn", lang: "Scottish Gaelic" },
        "Cromartyshire": { name: "Siorrachd ChrÃ²mbaidh", lang: "Scottish Gaelic" },
        "Dumfriesshire": { name: "Siorrachd DhÃ¹n Phris", lang: "Scottish Gaelic" },
        "Dunbartonshire": { name: "Siorrachd DhÃ¹n Bhreatainn", lang: "Scottish Gaelic" },
        "East Lothian": { name: "Siorrachd an Ear Leothain", lang: "Scottish Gaelic" },
        "Fife": { name: "FÃ¬obha", lang: "Scottish Gaelic" },
        "Inverness-shire": { name: "Siorrachd Inbhir Nis", lang: "Scottish Gaelic" },
        "Kincardineshire": { name: "Siorrachd Chinn ChÃ rdainn", lang: "Scottish Gaelic" },
        "Kinross-shire": { name: "Siorrachd Cheann Rois", lang: "Scottish Gaelic" },
        "Kirkcudbrightshire": { name: "Siorrachd Chille Chuithbeirt", lang: "Scottish Gaelic" },
        "Lanarkshire": { name: "Siorrachd Lanraig", lang: "Scottish Gaelic" },
        "Midlothian": { name: "Meadhan Labhdaidh", lang: "Scottish Gaelic" },
        "Morayshire": { name: "Moireibh", lang: "Scottish Gaelic" },
        "Nairnshire": { name: "Siorrachd Inbhir Narann", lang: "Scottish Gaelic" },
        "Orkney": { name: "Arcaibh", lang: "Scottish Gaelic" },
        "Peeblesshire": { name: "Siorrachd nam PÃ¹ballan", lang: "Scottish Gaelic" },
        "Perthshire": { name: "Siorrachd Pheairt", lang: "Scottish Gaelic" },
        "Renfrewshire": { name: "Siorrachd Rinn FriÃ¹", lang: "Scottish Gaelic" },
        "Ross-shire": { name: "Siorrachd Rois", lang: "Scottish Gaelic" },
        "Roxburghshire": { name: "Siorrachd Rosbroig", lang: "Scottish Gaelic" },
        "Selkirkshire": { name: "Siorrachd Shailcirc", lang: "Scottish Gaelic" },
        "Shetland": { name: "Sealtainn", lang: "Scottish Gaelic" },
        "Stirlingshire": { name: "Siorrachd Shruighlea", lang: "Scottish Gaelic" },
        "Sutherland": { name: "Cataibh", lang: "Scottish Gaelic" },
        "West Lothian": { name: "Lothian an Iar", lang: "Scottish Gaelic" },
        "Wigtownshire": { name: "Siorrachd Bhaile na h-Ã™ige", lang: "Scottish Gaelic" },
        "Antrim": { name: "Aontroim", lang: "Irish Gaelic" },
        "Armagh": { name: "Ãrd Mhacha", lang: "Irish Gaelic" },
        "Down": { name: "An DÃºn", lang: "Irish Gaelic" },
        "Fermanagh": { name: "Fear Manach", lang: "Irish Gaelic" },
        "Londonderry": { name: "Doire", lang: "Irish Gaelic" },
        "Tyrone": { name: "TÃ­r Eoghain", lang: "Irish Gaelic" }
      };

// Update card function
      function showPhoto(landmark, e) {
  clearTimeout(photoTimeout);
  hidePhoto(); // remove old image if any

  const img = document.createElement('img');
  img.src = `https://source.unsplash.com/400x300/?${encodeURIComponent(landmark + ' UK')}&${Date.now()}`;
  img.alt = landmark;
  img.style.cssText = `
    position: fixed;
    top: ${e.clientY + 10}px;
    left: ${e.clientX + 10}px;
    width: 200px;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 99999;
    pointer-events: none;
  `;

  document.body.appendChild(img); // append immediately
  window.photoImg = img;
}
window.updateCountyCard = function(englishName, layer, lat, lon) {
        const details = countyData[englishName] || {};
        const langEntry = countyLanguages[englishName];
        const area = details.area || 0;
        const pop = details.population || 0;
        const density = area > 0 ? (pop / area).toFixed(1) : 'N/A';

        let badgeStyle = '';
        if (density > 1000) badgeStyle = 'background:#9B2C2C; color:white;';
        else if (density > 500) badgeStyle = 'background:#D32F2F; color:white;';
        else if (density > 200) badgeStyle = 'background:#FF7043; color:white;';
        else if (density > 100) badgeStyle = 'background:#FFB300; color:white;';
        else if (density > 50) badgeStyle = 'background:#8BC34A; color:white;';
        else badgeStyle = 'background:#66BB6A; color:white;';

        fetchWeather(lat, lon).then(weather => {
          const weatherBlock = weather ? `
            <div style="text-align:center; margin:14px 0 8px;">
              <div class="weather-underline" style="margin:0 auto 14px;"></div>
              <div class="weather-badge">
                ${weather.temp}Â°C â€¢ ${weather.desc} â€¢ Wind ${weather.wind} mph
              </div>
            </div>` : '';

          const flagUrl = countyFlags[englishName];
          const flagHTML = flagUrl ? `<img src="${flagUrl}" alt="${englishName} flag" class="flag" onerror="this.style.display='none'">` : '';

const cardHTML = `
  <div class="county-card" style="margin-bottom:16px;">
    ${flagHTML}
    <div class="card-body">
      <h3>${englishName}</h3>
      ${langEntry ? `<p style="margin:6px 0; font-size:0.9rem; text-align:center;"><strong>${langEntry.lang}:</strong> ${langEntry.name}</p>` : ''}
      <div style="display:flex; justify-content:space-between; margin:12px 0; font-size:0.95rem;">
        <div><strong>Area:</strong> ${area.toLocaleString()} sq mi</div>
        <div><strong>Pop:</strong> ${pop.toLocaleString()}</div>
      </div>
      <div style="text-align:center; margin:12px 0;">
        <span style="${badgeStyle} padding:6px 16px; border-radius:20px; font-weight:600; font-size:0.9rem; display:inline-block; box-shadow:0 1px 3px rgba(0,0,0,0.2);">
          Density: ${density} people/sq mi
        </span>
      </div>

      ${details.events?.length ? `
        <div style="margin:14px 0 8px;">
          <h4 style="margin:0 0 6px; color:var(--accent); font-size:1rem; text-align:left; border-bottom:1px solid #eee; padding-bottom:4px;">Key Events</h4>
          <ul style="margin:6px 0; padding-left:20px; font-size:0.88rem; line-height:1.5; text-align:left;">
            ${details.events.map(e => `<li>${e}</li>`).join('')}
          </ul>
        </div>` : ''}

      ${details.landmarks?.length ? `
        <div style="margin:14px 0 8px;">
          <h4 style="margin:0 0 6px; color:var(--accent); font-size:1rem; text-align:left; border-bottom:1px solid #eee; padding-bottom:4px;">Notable Landmarks</h4>
          <ul style="margin:6px 0; padding-left:20px; font-size:0.88rem; line-height:1.5; text-align:left;">
            ${details.landmarks.map(l => `
              <li onmouseover="showPhoto('${l}', event)" onmouseout="hidePhoto()" style="cursor:pointer; color:#0066cc; text-decoration:underline;">
                ${l}
              </li>`).join('')}
          </ul>
        </div>` : ''}

      ${details.notablePersons?.length ? `
        <div style="margin:14px 0 8px;">
          <h4 style="margin:0 0 6px; color:var(--accent); font-size:1rem; text-align:left; border-bottom:1px solid #eee; padding-bottom:4px;">Notable Persons</h4>
          <ul style="margin:6px 0; padding-left:20px; font-size:0.88rem; line-height:1.5; text-align:left;">
            ${details.notablePersons.slice(0, 3).map(p => `<li>${p}</li>`).join('')}
          </ul>
        </div>` : ''}

      <!-- THIS IS THE MISSING DIV -->
      <div id="subdivision-buttons" style="margin:10px 0;"></div>

      ${weatherBlock}
    </div>
  </div>`;

// set innerHTML first
infoDiv.innerHTML = cardHTML;
infoDiv.scrollTop = 0;

// add subdivision buttons
const btnContainer = document.getElementById('subdivision-buttons');
if (btnContainer) {
  btnContainer.innerHTML = ''; // clear old buttons
  subdivisionsForCounty[englishName]?.forEach(sub => {
    const btn = document.createElement('button');
    btn.textContent = sub.label;
    btn.onclick = () => showSubdivision(englishName, sub.key);
    btnContainer.appendChild(btn);
  });
}
        })

      const pastelColors = ["#ffdede","#dedefd","#deffde","#fff0de","#fdefff","#dfffee","#ffe7de","#f0deff","#defff5","#fdeeee","#e6f7ff","#f9ffe6","#fff6e6","#e6e6ff","#ffe6f2"];
      data.features.forEach((f, i) => f.properties.color = pastelColors[i % pastelColors.length]);

      L.geoJSON(data, {
        style: f => ({ color: "#333", weight: 1, fillColor: f.properties.color, fillOpacity: 0.35 }),
        onEachFeature: (feature, layer) => {
          const englishName = feature.properties.NAME;
          const details = countyData[englishName] || {};
          const langEntry = countyLanguages[englishName];
          const density = details.area > 0 ? Math.round(details.population / details.area) : '?';
          const centroid = turf.centroid(feature);
          const lat = centroid.geometry.coordinates[1];
          const lon = centroid.geometry.coordinates[0];

          layer.bindTooltip(`
            <div style="text-align:center; font-weight:bold; font-size:0.95rem;">
              ${englishName}<br>
              ${langEntry ? `<small>${langEntry.lang}: ${langEntry.name}</small><br>` : ''}
              <small style="color:#555;">${density} people/sq mi</small>
            </div>
          `, { direction: 'center', className: 'county-tooltip' });

          layer.on('click', () => {
            layer._cardLayer = layer;
            window.updateCountyCard(englishName, layer, lat, lon);
            // === ADD SUBDIVISION BUTTONS HERE ===
            const subdivBox = document.getElementById("subdivision-buttons");
            subdivBox.innerHTML = ""; // clear previous buttons

            const subs = subdivisionFiles[englishName]; // your JSON mapping of county -> subdivision files
            if (subs) {
                Object.keys(subs).forEach(type => {
                    const btn = document.createElement("button");
                    btn.className = "subdivision-btn";
                    btn.textContent = "Show " + type;
                    btn.onclick = () => loadSubdivisionLayer(subs[type]);
                    subdivBox.appendChild(btn);
                });
            }
          });

            
            if (window.innerWidth <= 1024) sidebar.classList.add('visible');
            map.fitBounds(layer.getBounds());
          });

          layer.on('mouseover', () => layer.setStyle({ weight: 2 }));
          layer.on('mouseout', () => layer.setStyle({ weight: 1 }));
        }
      }).addTo(map);

      setTimeout(() => map.invalidateSize(), 300);
      infoDiv.innerHTML = '<em>Click a county to explore.</em>';
      infoDiv.classList.remove('loading');
    })
    .catch(err => {
      console.error(err);
      infoDiv.innerHTML = '<em style="color:red;">Failed to load map data. Check console.</em>';
    });

  // Search & Geocoder
  L.Control.geocoder({ defaultMarkGeocode: true, placeholder: 'Search town, village, postcodeâ€¦' }).addTo(map);
  window.places = []; let fuse = null; let searchMarker = null;

  function parseCSVLine(line) {
    const cols = []; const regex = /(?:\"([^\"]*)\"|([^,]+))/g; let m;
    while ((m = regex.exec(line)) !== null) cols.push(m[1] || m[2] || '');
    return cols;
  }

  function initFuse() {
    if (window.places.length) {
      fuse = new Fuse(window.places, {
        keys: ['name', 'county'],
        threshold: 0.4
      });
    }
  }

  function showDropdown(results) {
    searchDropdown.innerHTML = '';
    if (!results.length) { searchDropdown.style.display = 'none'; return; }
    results.slice(0, 10).forEach(r => {
      const div = document.createElement('div');
      div.style.cssText = 'padding:8px 12px; cursor:pointer; border-bottom:1px solid #eee; font-size:0.9rem;';
      div.textContent = `${r.item.name}, ${r.item.county || ''}`;
      div.onmouseover = () => div.style.backgroundColor = '#f5f5f5';
      div.onmouseout = () => div.style.backgroundColor = '';
      div.onclick = () => selectPlace(r.item);
      searchDropdown.appendChild(div);
    });
    searchDropdown.style.display = 'block';
  }

  function selectPlace(place) {
    if (searchMarker) map.removeLayer(searchMarker);
    searchMarker = L.marker([place.lat, place.lon]).addTo(map).bindPopup(`<b>${place.name}</b><br>${place.county}`).openPopup();
    map.setView([place.lat, place.lon], 11);
    searchDropdown.style.display = 'none';
    searchInput.value = place.name;
    setTimeout(() => showCountyFromPoint(place.lat, place.lon), 500);
  }

  async function loadSubdivisionLayer(fileName) {
    // Remove previous layer if any
    if (subdivisionLayer) {
        map.removeLayer(subdivisionLayer);
        subdivisionLayer = null;
    }

    try {
        const url = `subdivisions/${fileName}.json`;

        const response = await fetch(url);
        const geojson = await response.json();

        subdivisionLayer = L.geoJSON(geojson, {
            style: {
                color: "#444",
                weight: 1,
                fillOpacity: 0.15
            }
        }).addTo(map);

    } catch (err) {
        console.error("Failed to load subdivision layer:", fileName, err);
    }
}
const subdivisionFiles = {
    "Yorkshire": {
        "Ridings": "YorkshireRidingsA",
        "Wapentakes": "YorkshireWapentakesA"
    },
    "Lincolnshire": {
        "Parts": "LincolnshirePartsA",
        "Wapentakes": "LincolnshireWapentakesA"
    },
    "Sussex": {
        "Rapes": "SussexRapesA",
        "Hundreds": "SussexHundredsA"
    },
    "Kent": {
        "Lathes": "KentLathes",
        "Hundreds": "KentHundreds"
    },
    "Cumberland": {
        "Wards": "CumberlandWards"
    },
    "Durham": {
        "Wards": "DurhamWardsA"
    },
    "Northumberland": {
        "Wards": "NorthumberlandWardsA"
    },
    "Westmorland": {
        "Wards": "WestmorlandWardsA"
    },
    // Everything else = Hundreds by default
    "Bedfordshire": { "Hundreds": "BedfordshireHundredsA" },
    "Berkshire": { "Hundreds": "BerkshireHundredsA" },
    "Buckinghamshire": { "Hundreds": "BuckinghamshireHundredsA" },
    "Caernarfonshire": { "Hundreds": "CaernarfonshireHundredsA" },
    "Cambridgeshire": { "Hundreds": "CambridgeshireHundreds" },
    "Cardiganshire": { "Hundreds": "CardiganshireHundreds" },
    "Carmarthenshire": { "Hundreds": "CarmarthenshireHundreds" },
    "Cheshire": { "Hundreds": "CheshireHundreds" },
    "Cornwall": { "Hundreds": "CornwallHundredsA" },
    "Derbyshire": { "Hundreds": "DerbyshireHundredsA" },
    "Devon": { "Hundreds": "DevonHundredsA" },
    "Dorset": { "Hundreds": "DorsetHundredsA" },
    "Essex": { "Hundreds": "EssexHundreds" },
    "Flintshire": { "Hundreds": "FlintshireHundredsA" },
    "Glamorgan": { "Hundreds": "GlamorganHundreds" },
    "Gloucestershire": { "Hundreds": "GloucestershireHundredsA" },
    "Hampshire": { "Hundreds": "HampshireHundredsA" },
    "Herefordshire": { "Hundreds": "HerefordshireHundredsA" },
    "Hertfordshire": { "Hundreds": "HertfordshireHundredsA" },
    "Lanarkshire": { "Wards": "LanarkshireWards" },
    "Lancashire": { "Hundreds": "LancashireHundredsA" },
    "Leicestershire": { "Hundreds": "LeicestershireHundredsA" },
    "Lindsey": { "Ridings": "LindseyRidingsA" },
    "Lincolnshire": { "Hundreds": "LincolnshireWapentakesA" },
    "Merionethshire": { "Hundreds": "MerionethshireHundredsA" },
    "Middlesex": { "Hundreds": "MiddlesexHundreds" },
    "Monmouthshire": { "Hundreds": "MonmouthshireHundredsA" },
    "Montgomeryshire": { "Hundreds": "MontgomeryshireHundredsA" },
    "Norfolk": { "Hundreds": "NorfolkHundreds" },
    "Suffolk": { "Hundreds": "SuffolkHundreds" },
    "Northamptonshire": { "Hundreds": "NorthamptonshireHundredsA" },
    "Nottinghamshire": { "Wapentakes": "NottinghamshireWapentakesA" },
    "Oxfordshire": { "Hundreds": "OxfordshireHundredsA" },
    "Pembrokeshire": { "Hundreds": "PembrokeshireHundreds" },
    "Radnorshire": { "Hundreds": "RadnorshireHundredsA" },
    "Rutland": { "Hundreds": "RutlandHundreds" },
    "Shropshire": { "Hundreds": "ShropshireHundredsA" },
    "Somerset": { "Hundreds": "SomersetHundredsA" },
    "Staffordshire": { "Hundreds": "StaffordshireHundredsA" },
    "Surrey": { "Hundreds": "SurreyHundreds" },
    "Sussex": { "Hundreds": "SussexHundredsA" },
    "Warwickshire": { "Hundreds": "WarwickshireHundredsA" },
    "Wiltshire": { "Hundreds": "WiltshireHundredsA" }
};

  function showCountyFromPoint(lat, lon) {
    const point = turf.point([lon, lat]);
    let found = null;
    map.eachLayer(l => {
      if (l instanceof L.GeoJSON) {
        l.eachLayer(cl => {
          if (cl.getBounds && cl.getBounds().contains([lat, lon]) && turf.booleanPointInPolygon(point, cl.feature)) {
            found = cl;
          }
        });
      }
    });
    if (found) {
      const englishName = found.feature.properties.NAME;
      const centroid = turf.centroid(found.feature);
      window.updateCountyCard(englishName, found, centroid.geometry.coordinates[1], centroid.geometry.coordinates[0]);
      if (window.innerWidth <= 1024) sidebar.classList.add('visible');
    } else {
      infoDiv.innerHTML = '<em>County not found.</em>';
    }
  }

  fetch('places_clean.csv')
    .then(r => r.text())
    .then(text => {
      const lines = text.trim().split('\n');
      lines.shift(); // remove header
      lines.forEach(line => {
        const c = parseCSVLine(line);
        const name = c[0]?.trim();
        const desc = c[2]?.trim();
        const county = c[3]?.trim();
        const lat = parseFloat(c[6]);
        const lon = parseFloat(c[7]);
        if ((desc === 'LOC' || desc === 'PAR' || desc === 'COM' || desc === 'CTYHIST' || desc === 'NPARK')
            && name && !isNaN(lat) && !isNaN(lon)) {
          window.places.push({ name, county, lat, lon });
        }
      });
      initFuse();
    });

  searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim();
    if (!q || !fuse) { searchDropdown.style.display = 'none'; return; }
    showDropdown(fuse.search(q));
  });

  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && fuse) {
      const res = fuse.search(searchInput.value.trim());
      if (res.length) selectPlace(res[0].item);
    }
  });

  document.addEventListener('click', e => {
    if (!searchDropdown.contains(e.target) && e.target !== searchInput) {
      searchDropdown.style.display = 'none';
    }
  });
};
</script>
</body>
</html>
