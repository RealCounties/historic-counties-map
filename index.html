<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Historic Counties Interactive Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

<style>
html, body { 
  height: 100%; 
  margin: 0; 
  font-family: Arial, sans-serif; 
}

#container { 
  display: flex; 
  height: 100%; 
}

#logo-container {
  text-align: center;
  margin-bottom: 10px;
}

#sidebar-logo {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 0 auto;
}

/* Optional: scale logo on smaller screens */
@media (max-width: 1024px) {
  #sidebar-logo {
    max-width: 70%;
  }
}
@media (max-width: 480px) {
  #sidebar-logo {
    max-width: 50%;
  }
}

#sidebar {
  width: 340px;
  background: #f2e6d2;
  padding: 15px;
  overflow-y: auto;
  border-right: 1px solid #ccc;
  transition: all 0.3s ease;
  position: relative;
}
#search-bar {
  margin-top: 15px; /* space between county details and search bar */
}
#search-bar input {
  width: 180px;
  padding: 4px;
}
#search-bar button {
  padding: 4px 8px;
}

#map { 
  flex: 1; 
}

.county-card {
  background: #fff;
  padding: 12px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.county-card h3 { margin-top: 0; color: #333; }
.county-card p { margin: 4px 0; }
.county-card a { color: #0066cc; text-decoration: none; }
.county-card a:hover { text-decoration: underline; }

/* Tooltip style */
.leaflet-tooltip.county-tooltip {
  background-color: rgba(255,255,255,0.9);
  border: 1px solid #333;
  color: #333;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 4px;
}

/* Close button (hidden on desktop) */
#closeSidebar {
  display: none;
  position: absolute;
  top: 6px;
  right: 10px;
  font-size: 20px;
  background: none;
  border: none;
  color: #555;
  cursor: pointer;
  z-index: 1001;
}

/* ----- Responsive layout ----- */
@media (max-width: 1024px) {
  #container { flex-direction: column; }
  #sidebar {
    width: auto;
    height: auto;
    max-width: 90%;
    max-height: 70%;
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.97);
    display: none; /* hidden by default */
    z-index: 1000;
  }
  #sidebar.visible {
    display: block;
  }
  #closeSidebar {
    display: block;
  }
}
</style>
</head>
<body>
<div id="container">
  <div id="sidebar">
    <div id="logo-container">
      <img src="https://realcounties.wordpress.com/wp-content/uploads/2025/06/logo-full-trans-16-6-25.png" alt="Campaign for Historic Counties Logo" id="sidebar-logo">
    </div>

    <h2 style= "text align: center">Interactive Map</h2>
    <p>Select a county to view details.</p>

    <div id="info"><em>No county selected.</em></div>

    <div id="search-bar">
      <input type="text" id="placeSearch" placeholder="Search for a place...">
      <button id="searchBtn">Search</button>
    </div>
</div>

  <div id="map"></div>
</div>

<!-- JS libraries -->
<script src="https://cdn.jsdelivr.net/npm/polylabel@1.0.3/polylabel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<script>
window.onload = function() {
  var sidebar = document.getElementById('sidebar');
  var closeBtn = document.getElementById('closeSidebar');
  var infoDiv = document.getElementById('info');

  // -----------------------------
  // Initialize map FIRST
  // -----------------------------
  var map = L.map('map', { center: [54.5, -3], zoom: 6, minZoom: 5 });

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors | <a href="https://county-borders.co.uk" target="_blank">Historic County Borders Project</a>',
    maxZoom: 19
  }).addTo(map);

  // Restrict map to British Isles
  var ukBounds = L.latLngBounds([49.5, -8.5], [60.9, 2.0]);
  map.setMaxBounds(ukBounds);
  map.fitBounds(ukBounds);

  // -----------------------------
  // Floating sidebar toggle button (ðŸ“‹)
  // -----------------------------
  var toggleButton = L.control({ position: 'topright' });
  toggleButton.onAdd = function(map) {
    var btn = L.DomUtil.create('button', 'leaflet-bar');
    btn.innerHTML = 'ðŸ“‹';
    btn.title = 'Show county info';
    btn.style.background = 'white';
    btn.style.border = '1px solid #999';
    btn.style.width = '34px';
    btn.style.height = '34px';
    btn.style.fontSize = '18px';
    btn.style.cursor = 'pointer';
    btn.style.borderRadius = '4px';
    btn.style.boxShadow = '0 2px 4px rgba(0,0,0,0.3)';
    btn.onclick = function() {
      sidebar.classList.toggle('visible');
    };
    return btn;
  };
  toggleButton.addTo(map);

  closeBtn.onclick = function() {
    sidebar.classList.remove('visible');
  };

  // -----------------------------
  // County data
  // -----------------------------
  var countyData = {
  "Aberdeenshire": { area: "1,950 sq mi", population: "380,495", link: "" },
  "Anglesey": { area: "277 sq mi", population: "69,751", link: "" },
  "Angus": { area: "899 sq mi", population: "264,044", link: "" },
  "Antrim": { area: "1,175 sq mi", population: "615,701", link: "" },
  "Argyllshire": { area: "3,110 sq mi", population: "64,819", link: "" },
  "Armagh": { area: "512 sq mi", population: "178,598", link: "" },
  "Ayrshire": { area: "1,129 sq mi", population: "367,676", link: "" },
  "Banffshire": { area: "641 sq mi", population: "46,537", link: "" },
  "Bedfordshire": { area: "468 sq mi", population: "602,847", link: "" },
  "Berkshire": { area: "722 sq mi", population: "842,804", link: "" },
  "Berwickshire": { area: "457 sq mi", population: "26,458", link: "" },
  "Brecknockshire": { area: "742 sq mi", population: "67,598", link: "" },
  "Buckinghamshire": { area: "746 sq mi", population: "916,903", link: "" },
  "Buteshire": { area: "225 sq mi", population: "12,534", link: "" },
  "Caernarfonshire": { area: "563 sq mi", population: "139,065", link: "" },
  "Caithness": { area: "618 sq mi", population: "26,486", link: "" },
  "Cambridgeshire": { area: "858 sq mi", population: "460,448", link: "" },
  "Cardiganshire": { area: "693 sq mi", population: "75,784", link: "" },
  "Carmarthenshire": { area: "937 sq mi", population: "184,232", link: "" },
  "Cheshire": { area: "1,035 sq mi", population: "1,668,894", link: "" },
  "Clackmannanshire": { area: "48 sq mi", population: "50,957", link: "" },
  "Cornwall": { area: "1,365 sq mi", population: "533,594", link: "" },
  "Cromartyshire": { area: "370 sq mi", population: "7,074", link: "" },
  "Cumberland": { area: "1,525 sq mi", population: "306,241", link: "" },
  "Denbighshire": { area: "668 sq mi", population: "227,680", link: "" },
  "Derbyshire": { area: "1,017 sq mi", population: "1,148,373", link: "" },
  "Devon": { area: "2,621 sq mi", population: "1,133,463", link: "" },
  "Dorset": { area: "1,005 sq mi", population: "543,296", link: "" },
  "Down": { area: "950 sq mi", population: "528,983", link: "" },
  "Dumfriesshire": { area: "1,063 sq mi", population: "77,160", link: "" },
  "Dunbartonshire": { area: "241 sq mi", population: "262,419", link: "" },
  "Durham": { area: "1,022 sq mi", population: "1,467,037", link: "" },
  "East Lothian": { area: "267 sq mi", population: "74,882", link: "" },
  "Essex": { area: "1,591 sq mi", population: "2,999,248", link: "" },
  "Fermanagh": { area: "715 sq mi", population: "61,170", link: "" },
  "Fife": { area: "504 sq mi", population: "365,493", link: "" },
  "Flintshire": { area: "260 sq mi", population: "215,390", link: "" },
  "Glamorgan": { area: "827 sq mi", population: "1,321,460", link: "" },
  "Gloucestershire": { area: "1,293 sq mi", population: "1,147,106", link: "" },
  "Hampshire": { area: "1,656 sq mi", population: "2,099,640", link: "" },
  "Herefordshire": { area: "837 sq mi", population: "183,631", link: "" },
  "Hertfordshire": { area: "633 sq mi", population: "1,157,166", link: "" },
  "Huntingdonshire": { area: "366 sq mi", population: "211,776", link: "" },
  "Inverness-shire": { area: "4,211 sq mi", population: "118,077", link: "" },
  "Kent": { area: "1,611 sq mi", population: "2,747,715", link: "" },
  "Kincardineshire": { area: "380 sq mi", population: "77,670", link: "" },
  "Kinross-shire": { area: "73 sq mi", population: "11,223", link: "" },
  "Kirkcudbrightshire": { area: "899 sq mi", population: "47,546", link: "" },
  "Lanarkshire": { area: "879 sq mi", population: "1,008,014", link: "" },
  "Lancashire": { area: "1,909 sq mi", population: "4,942,364", link: "" },
  "Leicestershire": { area: "836 sq mi", population: "975,403", link: "" },
  "Lincolnshire": { area: "2,687 sq mi", population: "1,038,510", link: "" },
  "Londonderry": { area: "816 sq mi", population: "247,971", link: "" },
  "Merionethshire": { area: "676 sq mi", population: "37,874", link: "" },
  "Middlesex": { area: "285 sq mi", population: "4,000,927", link: "" },
  "Midlothian": { area: "362 sq mi", population: "621,610", link: "" },
  "Monmouthshire": { area: "542 sq mi", population: "514,723", link: "" },
  "Montgomeryshire": { area: "796 sq mi", population: "61,956", link: "" },
  "Morayshire": { area: "476 sq mi", population: "67,654", link: "" },
  "Nairnshire": { area: "200 sq mi", population: "13,894", link: "" },
  "Norfolk": { area: "2,057 sq mi", population: "807,721", link: "" },
  "Northamptonshire": { area: "998 sq mi", population: "838,786", link: "" },
  "Northumberland": { area: "2,019 sq mi", population: "797,006", link: "" },
  "Nottinghamshire": { area: "843 sq mi", population: "1,096,617", link: "" },
  "Orkney": { area: "376 sq mi", population: "21,349", link: "" },
  "Oxfordshire": { area: "754 sq mi", population: "512,345", link: "" },
  "Peeblesshire": { area: "548 sq mi", population: "19,074", link: "" },
  "Pembrokeshire": { area: "625 sq mi", population: "122,122", link: "" },
  "Perthshire": { area: "2,493 sq mi", population: "156,371", link: "" },
  "Radnorshire": { area: "470 sq mi", population: "25,821", link: "" },
  "Renfrewshire": { area: "245 sq mi", population: "508,064", link: "" },
  "Ross-shire": { area: "3,089 sq mi", population: "69,503", link: "" },
  "Roxburghshire": { area: "666 sq mi", population: "50,800", link: "" },
  "Rutland": { area: "152 sq mi", population: "37,677", link: "" },
  "Selkirkshire": { area: "267 sq mi", population: "16,010", link: "" },
  "Shetland": { area: "551 sq mi", population: "23,167", link: "" },
  "Shropshire": { area: "1,342 sq mi", population: "472,027", link: "" },
  "Somerset": { area: "1,633 sq mi", population: "1,053,504", link: "" },
  "Staffordshire": { area: "1,176 sq mi", population: "2,159,392", link: "" },
  "Stirlingshire": { area: "447 sq mi", population: "244,092", link: "" },
  "Suffolk": { area: "1,505 sq mi", population: "775,099", link: "" },
  "Surrey": { area: "759 sq mi", population: "2,975,836", link: "" },
  "Sussex": { area: "1,466 sq mi", population: "1,612,454", link: "" },
  "Sutherland": { area: "2,028 sq mi", population: "12,803", link: "" },
  "Tyrone": { area: "1,260 sq mi", population: "178,440", link: "" },
  "Warwickshire": { area: "918 sq mi", population: "1,632,885", link: "" },
  "West Lothian": { area: "120 sq mi", population: "154,830", link: "" },
  "Westmorland": { area: "785 sq mi", population: "87,466", link: "" },
  "Wigtownshire": { area: "487 sq mi", population: "26,618", link: "" },
  "Wiltshire": { area: "1,374 sq mi", population: "682,380", link: "" },
  "Worcestershire": { area: "709 sq mi", population: "1,125,037", link: "" },
  "Yorkshire": { area: "6,081 sq mi", population: "5,218,838", link: "" }
};

  // -----------------------------
  // Load GeoJSON and draw counties
  // -----------------------------
  fetch('./counties_simplified8.json')
    .then(res => res.json())
    .then(data => {
      const pastelColors = [
        "#ffdede","#dedefd","#deffde","#fff0de","#fdefff",
        "#dfffee","#ffe7de","#f0deff","#defff5","#fdeeee",
        "#e6f7ff","#f9ffe6","#fff6e6","#e6e6ff","#ffe6f2"
      ];

      data.features.forEach((feature, idx) => {
        feature.properties.color = pastelColors[idx % pastelColors.length];
      });

      var geoJsonLayer = L.geoJSON(data, {
        style: f => ({
          color: "#333",
          weight: 1,
          fillColor: f.properties.color,
          fillOpacity: 0.35
        }),
        onEachFeature: (feature, layer) => {
          const details = countyData[feature.properties.NAME] || {};
          layer.bindTooltip(`${feature.properties.NAME}`, { className: 'county-tooltip' });
          layer.on('click', () => {
            infoDiv.innerHTML = `
              <div class="county-card">
                <h3>${feature.properties.NAME}</h3>
                <p><strong>Area:</strong> ${details.area || 'Unknown'}</p>
                <p><strong>Population:</strong> ${details.population || 'Unknown'}</p>
              </div>`;
              
              try { map.fitBounds(layer.getBounds()); } catch(e) {}
            
            	// Show sidebar on mobile/tablet
  						if (window.innerWidth <= 1024) {
    					sidebar.classList.add('visible');
  						}
          	});
          layer.on('mouseover', () => layer.setStyle({ weight: 2 }));
          layer.on('mouseout', () => layer.setStyle({ weight: 1 }));
        }
      }).addTo(map);

      setTimeout(() => map.invalidateSize(), 100);
    });
  // --- Load place data from CSV ---
  fetch('https://realcounties.github.io/historic-counties-map/places_clean.csv')
    .then(response => response.text())
    .then(csvText => {
    // Parse CSV manually
    const lines = csvText.split('\n').slice(1);
    window.places = lines.map(line => {
      const [name, county, district, country, lat, lon] = line.split(',');
      return { name, county, district, country, lat: parseFloat(lat), lon: parseFloat(lon) };
    }).filter(p => p.name && !isNaN(p.lat) && !isNaN(p.lon));
    console.log(`Loaded ${window.places.length} places`);
  })
  .catch(err => console.error('Places CSV error:', err));

  // -----------------------------
  // Search control
  // -----------------------------
  L.Control.geocoder({
    defaultMarkGeocode: true,
    placeholder: 'Search town, village, postcodeâ€¦',
    geocoder: new L.Control.Geocoder.Nominatim()
  }).addTo(map);
};
    // --- Search function ---
document.getElementById('searchBtn').addEventListener('click', () => {
  const query = document.getElementById('placeSearch').value.trim().toLowerCase();
  if (!query || !window.places) return;

  const match = window.places.find(p => p.name.toLowerCase() === query);
  if (match) {
    map.setView([match.lat, match.lon], 11); // zoom in
    L.marker([match.lat, match.lon])
      .addTo(map)
      .bindPopup(`<b>${match.name}</b><br>${match.county ? match.county : ''}`)
      .openPopup();
  } else {
    alert('Place not found');
  }
});
</script>
</body>
</html>




















