<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Historic Counties Interactive Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>

<style>
:root {
  --bg: #faf4e6; --card-bg: #f3e9da; --text: #333; --border: #ccc;
  --shadow: rgba(0,0,0,0.2); --accent: #9B2C2C; --tooltip-bg: rgba(255,255,255,0.9);
}
html, body { height:100%; margin:0; font-family:Arial,sans-serif; }
#container { display:flex; height:100%; }
#logo-container { text-align:center; margin-bottom:10px; }
#sidebar-logo { max-width:100%; height:auto; display:block; margin:0 auto; opacity:0; transform:scale(0.9); animation:logoLoad 1.4s ease-out forwards; }
@keyframes logoLoad { 0% { opacity:0; transform:scale(0.9) translateY(10px); } 60% { opacity:1; transform:scale(1.02); } 100% { opacity:1; transform:scale(1); } }
#logo-link { display:block; transition:opacity .25s ease; } #logo-link:hover { opacity:.85; }
#sidebar { width:340px; background:var(--bg); padding:15px; overflow-y:auto; border-right:1px solid var(--border); transition:all .3s ease; position:relative; color:var(--text); }
#search-bar { margin-top:15px; display:flex; gap:6px; align-items:center; justify-content:center; }
#search-bar input { flex:1; min-width:140px; padding:10px 12px; border:1px solid var(--border); border-radius:4px; font-size:.9rem; color:var(--text); background:#fff; box-shadow:0 2px 4px var(--shadow); transition:all .25s; }
#search-bar input:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(155,44,44,.2); }
#search-bar button { padding:10px 18px; background:var(--accent); color:#FAF4E6; border:none; border-radius:4px; font-weight:500; box-shadow:0 3px 6px var(--shadow); cursor:pointer; transition:all .25s cubic-bezier(.4,0,.2,1); }
#search-bar button:hover { background:#7a2222; transform:translateY(-2px) scale(1.05); box-shadow:0 6px 14px var(--shadow); }
#map { flex:1; background:#e0f2fe; }
.county-card { background:var(--card-bg); padding:14px; border-radius:10px; box-shadow:0 2px 6px var(--shadow); transition:all .3s ease; cursor:pointer; position:relative; }
.county-card:hover { transform:translateY(-6px); box-shadow:0 8px 18px var(--shadow); }
.county-card h3 { margin:0 0 12px; font-size:1.25rem; color:var(--text); word-wrap:break-word; text-align:center; line-height:1.3; }
.weather-badge { display:inline-block; font-size:0.82rem; background:rgba(0,0,0,0.1); color:var(--text); padding:6px 12px; border-radius:16px; font-weight:500; box-shadow:0 1px 3px rgba(0,0,0,0.12); }
.weather-underline { width:60px; height:2px; background:var(--accent); margin:8px auto 12px; border-radius:1px; }
.county-card p, .county-card ul { margin:6px 0; }
.county-card a { color:#0066cc; text-decoration:none; } .county-card a:hover { text-decoration:underline; }
.leaflet-tooltip.county-tooltip { background:var(--tooltip-bg); border:1px solid var(--accent); color:var(--text); font-weight:bold; padding:2px 6px; border-radius:4px; }
#closeSidebar { display:none; position:absolute; top:10px; right:12px; width:32px; height:32px; font-size:20px; color:#666; background:rgba(255,255,255,0.9); border:none; border-radius:50%; cursor:pointer; align-items:center; justify-content:center; z-index:1001; }
#closeSidebar:hover { background:#fff; }
@media (max-width:1024px) {
  #container { flex-direction:column; }
  #sidebar { position:fixed; bottom:16px; left:16px; width:45vw; max-width:380px; max-height:50vh; background:var(--bg); border-radius:14px; box-shadow:0 6px 20px var(--shadow); padding:14px; overflow-y:auto; transform:translateY(120%); transition:transform .32s cubic-bezier(.4,0,.2,1); z-index:1000; display:block !important; font-size:.94rem; }
  #sidebar.visible { transform:translateY(0); }
  #map { height:100vh !important; }
  #sidebar-logo { max-width:65%; }
  #closeSidebar { display:flex; }
}
@media (max-width:480px) { #sidebar { width:90vw; left:5vw; max-width:none; } #sidebar-logo { max-width:55%; } }
#sidebar h2 { text-align:center; margin:5px 0 10px; color:var(--accent); }
</style>
</head>
<body>
<div id="container">
  <div id="sidebar">
    <button id="closeSidebar">x</button>
    <div id="logo-container">
      <a href="https://realcounties.com" target="_blank" rel="noopener" id="logo-link">
        <img src="https://realcounties.wordpress.com/wp-content/uploads/2025/06/logo-full-trans-16-6-25.png" alt="Campaign for Historic Counties Logo" id="sidebar-logo">
      </a>
    </div>
    <h2>Interactive Map</h2>
    <p>Select a county to view details.</p>
    <div id="info"><em>Loading counties...</em></div>
    <div id="search-bar">
      <input type="text" id="placeSearch" placeholder="Search for a place...">
      <button id="searchBtn">Search</button>
    </div>
    <div id="searchDropdown" style="position:absolute;background:white;border:1px solid #ccc;max-height:200px;overflow-y:auto;width:calc(100%-60px);display:none;z-index:1001;margin-top:5px;box-shadow:0 4px 8px rgba(0,0,0,0.1);"></div>
  </div>
  <div id="map"></div>
</div>

<script>
window.onload = function() {
  const sidebar = document.getElementById('sidebar');
  const closeBtn = document.getElementById('closeSidebar');
  const infoDiv = document.getElementById('info');
  const searchInput = document.getElementById('placeSearch');
  const searchDropdown = document.getElementById('searchDropdown');

  const map = L.map('map', { center: [54.5, -3], zoom: 6, minZoom: 5 });
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> | <a href="https://county-borders.co.uk" target="_blank">Historic County Borders Project</a>',
    maxZoom: 19
  }).addTo(map);
  const ukBounds = L.latLngBounds([49.5, -8.5], [60.9, 2.0]);
  map.setMaxBounds(ukBounds);
  map.fitBounds(ukBounds);

  const toggleButton = L.control({ position: 'topright' });
  toggleButton.onAdd = function() {
    const btn = L.DomUtil.create('button', 'leaflet-bar');
    btn.innerHTML = 'Info'; btn.title = 'Show county info';
    btn.style.cssText = 'background:white; border:1px solid #999; width:34px; height:34px; font-size:18px; cursor:pointer; border-radius:4px; box-shadow:0 2px 4px rgba(0,0,0,0.3);';
    btn.onclick = () => sidebar.classList.toggle('visible');
    return btn;
  };
  toggleButton.addTo(map);
  closeBtn.onclick = () => sidebar.classList.remove('visible');

  async function fetchWeather(lat, lon) {
    try {
      const res = await axios.get(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,wind_speed_10m`);
      const temp = Math.round(res.data.current.temperature_2m);
      const code = res.data.current.weather_code;
      const wind = Math.round(res.data.current.wind_speed_10m);
      const descMap = {0:'Clear',1:'Mostly clear',2:'Partly cloudy',3:'Overcast',45:'Fog',48:'Fog',51:'Light drizzle',53:'Drizzle',55:'Heavy drizzle',61:'Light rain',63:'Rain',65:'Heavy rain',71:'Light snow',73:'Snow',75:'Heavy snow',80:'Showers',81:'Rain showers',82:'Heavy showers',95:'Thunderstorm'};
      const desc = descMap[code] || 'Unknown';
      return { temp, desc, wind };
    } catch { return null; }
  }

  let currentLayer = null;
  let photoTimeout;
  function showPhoto(landmark, e) {
    clearTimeout(photoTimeout);
    const img = document.createElement('img');
    img.src = `https://source.unsplash.com/400x300/?${encodeURIComponent(landmark + ' UK')}`;
    img.style.cssText = 'position:absolute; top:'+(e.clientY+10)+'px; left:'+(e.clientX+10)+'px; width:200px; height:auto; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.3); z-index:10000;';
    img.onload = () => document.body.appendChild(img);
    window.photoImg = img;
  }
  function hidePhoto() {
    photoTimeout = setTimeout(() => {
      if (window.photoImg) { document.body.removeChild(window.photoImg); delete window.photoImg; }
    }, 300);
  }

  // COUNTY DATA (NUMBERS ONLY) – 92 HISTORIC COUNTIES – NO EVENT/LANDMARK OVERLAP
const countyData = {
  "Aberdeenshire": {
    area: 1950, population: 380495,
    events: ["Battle of Harlaw (1411)", "Aberdeen University founded (1495)", "North Sea oil boom begins (1970s)"],
    landmarks: ["Slains Castle", "Balmoral Castle", "Dunnottar Castle"]
  },
  "Anglesey": {
    area: 277, population: 69751,
    events: ["Roman invasion repelled (60 AD)", "Menai Suspension Bridge opens (1826)", "RAF Valley established (1941)"],
    landmarks: ["Beaumaris Castle", "South Stack Lighthouse", "Plas Newydd"]
  },
  "Antrim": {
    area: 1175, population: 615701,
    events: ["Titanic launched from Belfast (1911)", "Dark Hedges planted (1775)", "Belfast Blitz air raids (1941)"],
    landmarks: ["Giant's Causeway", "Carrickfergus Castle", "Antrim Castle Gardens"]
  },
  "Argyllshire": {
    area: 3110, population: 64819,
    events: ["Massacre of Glencoe (1692)", "Oban Distillery founded (1794)", "Kilmartin Glen excavations (1860s)"],
    landmarks: ["Iona Abbey", "Inveraray Castle", "Kilmartin Glen"]
  },
  "Armagh": {
    area: 512, population: 178598,
    events: ["St Patrick founds cathedral (445 AD)", "Armagh Observatory opens (1790)", "Troubles begin in region (1969)"],
    landmarks: ["Armagh Cathedral", "Navan Fort", "Armagh Planetarium"]
  },
  "Ayrshire": {
    area: 1129, population: 367676,
    events: ["Battle of Largs (1263)", "Robert Burns born in Alloway (1759)", "Ayr Racecourse founded (1907)"],
    landmarks: ["Culzean Castle", "Burns Cottage", "Ailsa Craig"]
  },
  "Banffshire": {
    area: 641, population: 46537,
    events: ["Banff Bridge rebuilt (1779)", "Glenfiddich Distillery founded (1887)", "Portsoy Marble discovered (1700s)"],
    landmarks: ["Duff House", "Balvenie Castle", "Portsoy Harbour"]
  },
  "Bedfordshire": {
    area: 468, population: 602847,
    events: ["Roman settlement at Sandy (1st c. AD)", "John Bunyan writes in prison (1678)", "Woburn Safari Park opens (1970)"],
    landmarks: ["Woburn Abbey", "Whipsnade Zoo", "Shuttleworth Collection"]
  },
  "Berkshire": {
    area: 722, population: 842804,
    events: ["Battle of Reading (871 AD)", "Magna Carta sealed at Runnymede (1215)", "Ascot Racecourse founded (1711)"],
    landmarks: ["Windsor Castle", "Ascot Racecourse", "Shaw House"]
  },
  "Berwickshire": {
    area: 457, population: 26458,
    events: ["Flodden Field aftermath (1513)", "Union of Crowns impacts trade (1603)", "Eyemouth fishing disaster (1881)"],
    landmarks: ["Paxton House", "Duns Castle", "St Abb’s Head"]
  },
  "Brecknockshire": {
    area: 742, population: 67598,
    events: ["Norman conquest of Brycheiniog (1093)", "Brecon & Merthyr Railway opens (1863)", "Llangorse Lake drained (1800s)"],
    landmarks: ["Brecon Beacons", "Brecon Cathedral", "Llangorse Lake"]
  },
  "Buckinghamshire": {
    area: 746, population: 916903,
    events: ["John Milton writes in Chalfont (1667)", "Bletchley Park breaks Enigma (1940)", "Pinewood Studios founded (1936)"],
    landmarks: ["Bletchley Park", "Stowe House", "Eton College"]
  },
  "Buteshire": {
    area: 225, population: 12534,
    events: ["Rothesay Castle siege (1401)", "Mount Stuart completed (1879)", "Bute Highland Games begin (1800s)"],
    landmarks: ["Rothesay Castle", "Mount Stuart House", "Bute Museum"]
  },
  "Caernarfonshire": {
    area: 563, population: 139065,
    events: ["Edward I builds Caernarfon Castle (1283)", "Snowdon Mountain Railway opens (1896)", "Prince Charles investiture (1969)"],
    landmarks: ["Caernarfon Castle", "Snowdon", "Llanberis Slate Museum"]
  },
  "Caithness": {
    area: 618, population: 26486,
    events: ["Norse earldom established (871)", "Castle of Mey acquired by Queen Mother (1952)", "Dounreay nuclear site opens (1955)"],
    landmarks: ["Castle of Mey", "John o’ Groats", "Duncansby Stacks"]
  },
  "Cambridgeshire": {
    area: 858, population: 460448,
    events: ["Iceni revolt led by Boudicca (60 AD)", "University of Cambridge founded (1209)", "Fens drainage begins (1630s)"],
    landmarks: ["King’s College Chapel", "Ely Cathedral", "Duxford IWM"]
  },
  "Cardiganshire": {
    area: 693, population: 75784,
    events: ["Aberystwyth Castle built (1277)", "Aberystwyth University founded (1872)", "Devil’s Bridge built (1753)"],
    landmarks: ["Devil’s Bridge", "Strata Florida Abbey", "Vale of Rheidol Railway"]
  },
  "Carmarthenshire": {
    area: 937, population: 184232,
    events: ["Carreg Cennen Castle falls (1277)", "Rebecca Riots begin (1839)", "National Botanic Garden opens (2000)"],
    landmarks: ["Carreg Cennen Castle", "Laugharne Castle", "National Botanic Garden"]
  },
  "Cheshire": {
    area: 1035, population: 1668894,
    events: ["Roman Deva fortress founded (75 AD)", "Civil War siege of Chester (1645)", "Jodrell Bank telescope opens (1957)"],
    landmarks: ["Chester Cathedral", "Beeston Castle", "Jodrell Bank"]
  },
  "Clackmannanshire": {
    area: 48, population: 50957,
    events: ["Gartmorn Dam completed (1713)", "Alloa Glass Cone built (1770s)", "Dollar Glen opened to public (1880s)"],
    landmarks: ["Alloa Tower", "Castle Campbell", "Dollar Glen"]
  },
  "Cornwall": {
    area: 1365, population: 533594,
    events: ["Tin mining in Roman era (1st c.)", "Prayer Book Rebellion (1549)", "Eden Project opens (2001)"],
    landmarks: ["St Michael’s Mount", "Eden Project", "Tintagel Castle"]
  },
  "Cromartyshire": {
    area: 370, population: 7074,
    events: ["Cromarty sheriffdom created (1685)", "Hugh Miller discovers fossils (1820s)", "Ullapool founded (1788)"],
    landmarks: ["Cromarty Courthouse", "Hugh Miller’s Cottage", "Ullapool Harbour"]
  },
  "Cumberland": {
    area: 1525, population: 306241,
    events: ["Border Reivers peak (16th c.)", "Carlisle Citadel built (1541)", "Lake District National Park (1951)"],
    landmarks: ["Carlisle Castle", "Hadrian’s Wall", "Scafell Pike"]
  },
  "Denbighshire": {
    area: 668, population: 277680,
    events: ["Denbigh Castle built (1282)", "Pontcysyllte Aqueduct opens (1805)", "Llangollen Eisteddfod begins (1947)"],
    landmarks: ["Denbigh Castle", "Pontcysyllte Aqueduct", "Llangollen Railway"]
  },
  "Derbyshire": {
    area: 1017, population: 1148373,
    events: ["Creswell Crags rock art (13,000 BC)", "Cromford Mill opens (1771)", "Peak District National Park (1951)"],
    landmarks: ["Chatsworth House", "Cromford Mill", "Peak Cavern"]
  },
  "Devon": {
    area: 2621, population: 1133463,
    events: ["Roman Isca Dumnoniorum founded (50 AD)", "Spanish Armada wrecks (1588)", "Dartmoor Prison opens (1809)"],
    landmarks: ["Dartmoor", "Exeter Cathedral", "Jurassic Coast"]
  },
  "Dorset": {
    area: 1005, population: 543296,
    events: ["Cerne Abbas Giant carved (pre-1000)", "Tolpuddle Martyrs trial (1834)", "Dorset Coast UNESCO (2001)"],
    landmarks: ["Cerne Abbas Giant", "Lulworth Cove", "Durdlestone Head"]
  },
  "Down": {
    area: 950, population: 528983,
    events: ["St Patrick lands in Ireland (432 AD)", "Scrabo Tower built (1857)", "Mourne granite quarried (19th c.)"],
    landmarks: ["Mourne Mountains", "Downpatrick Cathedral", "Scrabo Tower"]
  },
  "Dumfriesshire": {
    area: 1063, population: 77160,
    events: ["Robert the Bruce kills Comyn (1306)", "Devorgilla Bridge built (1432)", "Burns Mausoleum erected (1815)"],
    landmarks: ["Caerlaverock Castle", "Sweetheart Abbey", "Devorgilla Bridge"]
  },
  "Dunbartonshire": {
    area: 241, population: 262419,
    events: ["Viking siege of Dumbarton (870)", "Hill House designed by Mackintosh (1904)", "Loch Lomond public park (1930s)"],
    landmarks: ["Dumbarton Castle", "Loch Lomond", "Hill House"]
  },
  "Durham": {
    area: 1022, population: 1467037,
    events: ["Lindisfarne Gospels created (698 AD)", "Durham Cathedral begun (1093)", "Beamish Museum opens (1970)"],
    landmarks: ["Durham Cathedral", "Beamish Museum", "High Force Waterfall"]
  },
  "East Lothian": {
    area: 267, population: 74882,
    events: ["Tantallon Castle built (1350s)", "Battle of Prestonpans (1745)", "John Muir born in Dunbar (1838)"],
    landmarks: ["Tantallon Castle", "Dirleton Castle", "Bass Rock"]
  },
  "Essex": {
    area: 1591, population: 2999248,
    events: ["Battle of Maldon (991)", "Southend Pier opens (1830)", "Harlow New Town founded (1947)"],
    landmarks: ["Colchester Castle", "Audley End House", "Southend Pier"]
  },
  "Fermanagh": {
    area: 715, population: 61170,
    events: ["Devenish Island monastery (6th c.)", "Enniskillen Castle built (1611)", "Marble Arch Caves discovered (1895)"],
    landmarks: ["Enniskillen Castle", "Devenish Island", "Marble Arch Caves"]
  },
  "Fife": {
    area: 504, population: 365493,
    events: ["St Andrews University founded (1413)", "Falkland Palace built (1500s)", "Culross Palace completed (1597)"],
    landmarks: ["St Andrews Cathedral", "Falkland Palace", "Culross Palace"]
  },
  "Flintshire": {
    area: 260, population: 215390,
    events: ["St Winifred’s Well pilgrimage (7th c.)", "Flint Castle built (1277)", "Greenfield Valley mills boom (1780s)"],
    landmarks: ["Flint Castle", "St Winifred’s Well", "Basingwerk Abbey"]
  },
  "Glamorgan": {
    area: 827, population: 1321460,
    events: ["Norman invasion of Glamorgan (1093)", "Coal export boom begins (1830s)", "Cardiff declared capital (1955)"],
    landmarks: ["Cardiff Castle", "Castell Coch", "National Museum Cardiff"]
  },
  "Gloucestershire": {
    area: 1293, population: 1147106,
    events: ["Gloucester Cathedral begun (1089)", "Edward II murdered at Berkeley (1327)", "Cotswold Olympick Games begin (1612)"],
    landmarks: ["Gloucester Cathedral", "Berkeley Castle", "Cotswold Way"]
  },
  "Hampshire": {
    area: 1656, population: 2099640,
    events: ["Winchester Cathedral founded (1079)", "Jane Austen settles in Chawton (1809)", "D-Day embarkation from Portsmouth (1944)"],
    landmarks: ["Highclere Castle", "Portsmouth Dockyard", "New Forest"]
  },
  "Herefordshire": {
    area: 837, population: 183631,
    events: ["Offa’s Dyke built (8th c.)", "Mappa Mundi created (1300)", "Hereford Cathedral chained library (1611)"],
    landmarks: ["Hereford Cathedral", "Goodrich Castle", "Black & White Villages"]
  },
  "Hertfordshire": {
    area: 633, population: 1157166,
    events: ["Verulamium Roman city founded (43 AD)", "Hatfield House built (1611)", "Warner Bros. Studio opens (2012)"],
    landmarks: ["St Albans Cathedral", "Hatfield House", "Warner Bros. Studio"]
  },
  "Huntingdonshire": {
    area: 366, population: 211776,
    events: ["Ramsey Abbey founded (969)", "Oliver Cromwell born in Huntingdon (1599)", "Grafham Water reservoir opens (1965)"],
    landmarks: ["Hinchingbrooke House", "Ramsey Abbey Gatehouse", "Grafham Water"]
  },
  "Inverness-shire": {
    area: 4211, population: 118077,
    events: ["Urquhart Castle built (13th c.)", "Caledonian Canal opens (1822)", "Loch Ness Monster reported (1933)"],
    landmarks: ["Loch Ness", "Urquhart Castle", "Eilean Donan Castle"]
  },
  "Kent": {
    area: 1611, population: 2747715,
    events: ["St Augustine lands at Thanet (597)", "Dover Castle built (1180s)", "Channel Tunnel opens (1994)"],
    landmarks: ["Canterbury Cathedral", "Leeds Castle", "White Cliffs of Dover"]
  },
  "Kincardineshire": {
    area: 380, population: 77670,
    events: ["Dunnottar Castle siege (1651)", "Fetteresso Castle rebuilt (1782)", "Stonehaven Tolbooth built (1600)"],
    landmarks: ["Dunnottar Castle", "Stonehaven Harbour", "Muchalls Castle"]
  },
  "Kinross-shire": {
    area: 73, population: 11223,
    events: ["Loch Leven Castle built (1300s)", "Mary Queen of Scots imprisoned (1567)", "Kinross House completed (1680s)"],
    landmarks: ["Loch Leven Castle", "Kinross House", "RSPB Vane Farm"]
  },
  "Kirkcudbrightshire": {
    area: 899, population: 47546,
    events: ["Threave Castle built (1370s)", "Artists’ colony begins (1880s)", "Broughton House museum opens (1920s)"],
    landmarks: ["Threave Castle", "Broughton House", "Dundrennan Abbey"]
  },
  "Lanarkshire": {
    area: 879, population: 1008014,
    events: ["Bothwell Bridge Battle (1679)", "New Lanark founded (1785)", "Falls of Clyde power station (1927)"],
    landmarks: ["New Lanark", "Chatelherault", "Falls of Clyde"]
  },
  "Lancashire": {
    area: 1909, population: 4942364,
    events: ["Lancaster Castle prison (1196)", "Peterloo Massacre in Manchester (1819)", "Blackpool Tower opens (1894)"],
    landmarks: ["Lancaster Castle", "Blackpool Tower", "Ribblehead Viaduct"]
  },
  "Leicestershire": {
    area: 836, population: 975403,
    events: ["Richard III killed at Bosworth (1485)", "Belvoir Castle rebuilt (1801)", "National Space Centre opens (2001)"],
    landmarks: ["Bosworth Battlefield", "Belvoir Castle", "National Space Centre"]
  },
  "Lincolnshire": {
    area: 2687, population: 1038510,
    events: ["Lincoln Cathedral tallest in world (1311)", "Tattershall Castle built (1430s)", "RAF Scampton Dambusters (1943)"],
    landmarks: ["Lincoln Cathedral", "Tattershall Castle", "Theddlethorpe Dunes"]
  },
  "Londonderry": {
    area: 816, population: 247971,
    events: ["Derry city walls built (1613)", "Siege of Derry (1689)", "Peace Bridge opens (2011)"],
    landmarks: ["Derry City Walls", "Guildhall", "Peace Bridge"]
  },
  "Merionethshire": {
    area: 676, population: 37874,
    events: ["Owain Glyndŵr holds parliament (1404)", "Ffestiniog Railway opens (1836)", "Mawddach Estuary bridge (1878)"],
    landmarks: ["Harlech Castle", "Portmeirion Village", "Cader Idris"]
  },
  "Middlesex": {
    area: 285, population: 4000927,
    events: ["Westminster Abbey founded (960)", "Great Fire of London (1666)", "London Underground opens (1863)"],
    landmarks: ["Hampton Court Palace", "Kew Gardens", "Wembley Stadium"]
  },
  "Midlothian": {
    area: 362, population: 621610,
    events: ["Edinburgh Castle built (12th c.)", "Scottish Enlightenment begins (18th c.)", "Scottish Parliament opens (2004)"],
    landmarks: ["Edinburgh Castle", "Rosslyn Chapel", "Scottish Parliament"]
  },
  "Monmouthshire": {
    area: 542, population: 514723,
    events: ["Raglan Castle built (1430s)", "Chartist Rising in Newport (1839)", "Big Pit opens as museum (1983)"],
    landmarks: ["Tintern Abbey", "Raglan Castle", "Big Pit"]
  },
  "Montgomeryshire": {
    area: 796, population: 61956,
    events: ["Owain Glyndŵr rebellion (1400)", "Montgomery Canal opens (1796)", "Lake Vyrnwy dam opens (1880s)"],
    landmarks: ["Powis Castle", "Montgomery Castle", "Lake Vyrnwy"]
  },
  "Morayshire": {
    area: 476, population: 67654,
    events: ["Elgin Cathedral founded (1224)", "Pluscarden Abbey founded (1230)", "Glen Moray Distillery founded (1897)"],
    landmarks: ["Elgin Cathedral", "Pluscarden Abbey", "Duffus Castle"]
  },
  "Nairnshire": {
    area: 200, population: 13894,
    events: ["Cawdor Castle built (1454)", "Battle of Auldearn (1645)", "Nairn Golf Club founded (1887)"],
    landmarks: ["Cawdor Castle", "Nairn Museum", "Nairn Viaduct"]
  },
  "Norfolk": {
    area: 2057, population: 807721,
    events: ["Venta Icenorum Roman capital (1st c.)", "Norwich Cathedral begun (1096)", "Sandringham bought by royals (1862)"],
    landmarks: ["Norwich Cathedral", "Sandringham House", "Holkham Hall"]
  },
  "Northamptonshire": {
    area: 998, population: 838786,
    events: ["Battle of Naseby (1645)", "Althorp House built (1508)", "Silverstone Circuit opens (1948)"],
    landmarks: ["Althorp", "Rockingham Castle", "Silverstone"]
  },
  "Northumberland": {
    area: 2019, population: 797006,
    events: ["Lindisfarne Priory founded (634)", "Hadrian’s Wall built (122 AD)", "Kielder Water opens (1982)"],
    landmarks: ["Hadrian’s Wall", "Alnwick Castle", "Lindisfarne"]
  },
  "Nottinghamshire": {
    area: 843, population: 1096617,
    events: ["Robin Hood legend begins (13th c.)", "DH Lawrence born in Eastwood (1885)", "Creswell Crags museum opens (2009)"],
    landmarks: ["Sherwood Forest", "Nottingham Castle", "Wollaton Hall"]
  },
  "Orkney": {
    area: 376, population: 21349,
    events: ["Skara Brae occupied (3100 BC)", "St Magnus Cathedral begun (1137)", "Scapa Flow scuttling (1919)"],
    landmarks: ["Skara Brae", "St Magnus Cathedral", "Ring of Brodgar"]
  },
  "Oxfordshire": {
    area: 754, population: 512345,
    events: ["Oxford University teaching begins (1096)", "Blenheim Palace built (1705)", "Mini car production starts (1959)"],
    landmarks: ["Oxford Colleges", "Blenheim Palace", "Christ Church Cathedral"]
  },
  "Peeblesshire": {
    area: 548, population: 19074,
    events: ["Neidpath Castle built (14th c.)", "Tweed Bridge built (1465)", "Peebles Hydro opens (1881)"],
    landmarks: ["Traquair House", "Neidpath Castle", "Dawyck Botanic Garden"]
  },
  "Pembrokeshire": {
    area: 625, population: 122122,
    events: ["St David’s Cathedral founded (1181)", "Last invasion of Britain at Fishguard (1797)", "Pembrokeshire Coast Path opens (1970)"],
    landmarks: ["St David’s Cathedral", "Pembroke Castle", "Skomer Island"]
  },
  "Perthshire": {
    area: 2493, population: 156371,
    events: ["Scone Abbey founded (1114)", "Battle of Killiecrankie (1689)", "Tay Bridge collapse (1879)"],
    landmarks: ["Scone Palace", "Blair Castle", "Loch Tay"]
  },
  "Radnorshire": {
    area: 470, population: 25821,
    events: ["Radnor Castle built (11th c.)", "Llandrindod Wells spa boom (1870s)", "Elan Valley dams open (1893)"],
    landmarks: ["Elan Valley", "Radnor Forest", "Llandrindod Wells"]
  },
  "Renfrewshire": {
    area: 245, population: 508064,
    events: ["Paisley Abbey founded (1163)", "Weaver’s Cottage preserved (1723)", "Coats Observatory opens (1883)"],
    landmarks: ["Paisley Abbey", "Coats Observatory", "Castle Semple"]
  },
  "Ross-shire": {
    area: 3089, population: 69503,
    events: ["Dingwall Castle built (13th c.)", "Lewis Chessmen found (1831)", "Beinn Eighe nature reserve (1951)"],
    landmarks: ["Eilean Donan Castle", "Inverewe Garden", "Loch Maree"]
  },
  "Roxburghshire": {
    area: 666, population: 50800,
    events: ["Jedburgh Abbey founded (1138)", "Floors Castle built (1721)", "Hawick textile boom (19th c.)"],
    landmarks: ["Floors Castle", "Kelso Abbey", "Hermitage Castle"]
  },
  "Rutland": {
    area: 152, population: 37677,
    events: ["Oakham Castle founded (1180)", "Uppingham School founded (1584)", "Rutland Water created (1976)"],
    landmarks: ["Rutland Water", "Oakham Castle", "Rockingham Castle"]
  },
  "Selkirkshire": {
    area: 267, population: 16010,
    events: ["Ettrick Forest royal hunting (1100s)", "Battle of Philiphaugh (1645)", "Selkirk Common Riding (16th c.)"],
    landmarks: ["Bowhill House", "Philiphaugh Battlefield", "Loch of the Lowes"]
  },
  "Shetland": {
    area: 551, population: 23167,
    events: ["Jarlshof occupied (2500 BC)", "Mousa Broch built (100 BC)", "Shetland Bus WWII operations (1940s)"],
    landmarks: ["Jarlshof", "Shetland Museum", "Mousa Broch"]
  },
  "Shropshire": {
    area: 1342, population: 472027,
    events: ["Battle of Shrewsbury (1403)", "Iron Bridge opens (1781)", "Shrewsbury Flaxmill opens (1797)"],
    landmarks: ["Ironbridge Gorge", "Shrewsbury Castle", "Ludlow Castle"]
  },
  "Somerset": {
    area: 1633, population: 1053504,
    events: ["Glastonbury Abbey founded (712)", "Monmouth Rebellion at Sedgemoor (1685)", "Glastonbury Festival begins (1970)"],
    landmarks: ["Glastonbury Tor", "Wells Cathedral", "Cheddar Gorge"]
  },
  "Staffordshire": {
    area: 1176, population: 2159392,
    events: ["Lichfield Cathedral founded (669)", "Wedgwood pottery founded (1759)", "Alton Towers opens (1980)"],
    landmarks: ["Lichfield Cathedral", "Alton Towers", "Trentham Estate"]
  },
  "Stirlingshire": {
    area: 447, population: 244092,
    events: ["Battle of Bannockburn (1314)", "Stirling Castle royal residence (15th c.)", "Wallace Monument built (1869)"],
    landmarks: ["Stirling Castle", "Bannockburn", "Wallace Monument"]
  },
  "Suffolk": {
    area: 1505, population: 775099,
    events: ["Sutton Hoo burial (625 AD)", "Bury St Edmunds Abbey founded (1020)", "Southwold Pier opens (1900)"],
    landmarks: ["Sutton Hoo", "Framlingham Castle", "Southwold Pier"]
  },
  "Surrey": {
    area: 759, population: 2975836,
    events: ["Farnham Castle built (1138)", "Brooklands racetrack opens (1907)", "RHS Wisley founded (1878)"],
    landmarks: ["Runnymede", "Hampton Court", "Brooklands Museum"]
  },
  "Sussex": {
    area: 1466, population: 1612454,
    events: ["Battle of Hastings (1066)", "Brighton Pavilion built (1787)", "Gatwick Airport opens (1958)"],
    landmarks: ["Battle Abbey", "Arundel Castle", "Brighton Pavilion"]
  },
  "Sutherland": {
    area: 2028, population: 12803,
    events: ["Dornoch Cathedral built (1222)", "Highland Clearances begin (1814)", "Cape Wrath lighthouse opens (1828)"],
    landmarks: ["Dunrobin Castle", "Cape Wrath", "Smoo Cave"]
  },
  "Tyrone": {
    area: 1260, population: 178440,
    events: ["Beaghmore stone circles (2000 BC)", "Flight of the Earls (1607)", "Ulster American Folk Park opens (1976)"],
    landmarks: ["Ulster American Folk Park", "Sperrin Mountains", "Beaghmore Stone Circles"]
  },
  "Warwickshire": {
    area: 918, population: 1632885,
    events: ["Kenilworth Castle built (1100s)", "Shakespeare born in Stratford (1564)", "Coventry Cathedral bombed (1940)"],
    landmarks: ["Stratford-upon-Avon", "Warwick Castle", "Kenilworth Castle"]
  },
  "West Lothian": {
    area: 120, population: 154830,
    events: ["Linlithgow Palace built (1424)", "Battle of Linlithgow Bridge (1526)", "Shale oil industry peaks (1860s)"],
    landmarks: ["Linlithgow Palace", "Blackness Castle", "Almond Valley"]
  },
  "Westmorland": {
    area: 785, population: 87466,
    events: ["Appleby Horse Fair begins (1100s)", "Levens Hall topiary planted (1694)", "Kendal mint cake invented (1869)"],
    landmarks: ["Kendal Castle", "Levens Hall", "Rydal Mount"]
  },
  "Wigtownshire": {
    area: 487, population: 26618,
    events: ["St Ninian at Whithorn (397 AD)", "Stranraer ferry port opens (1862)", "Wigtown Book Town founded (1998)"],
    landmarks: ["Logan Botanic Garden", "Mull of Galloway", "Whithorn Priory"]
  },
  "Wiltshire": {
    area: 1374, population: 682380,
    events: ["Stonehenge built (3000 BC)", "Avebury stone circle (2600 BC)", "Salisbury Cathedral spire (1320)"],
    landmarks: ["Stonehenge", "Avebury", "Salisbury Cathedral"]
  },
  "Worcestershire": {
    area: 709, population: 1125037,
    events: ["Battle of Worcester (1651)", "Elgar born in Broadheath (1857)", "Morgan Motor Company founded (1910)"],
    landmarks: ["Worcester Cathedral", "Malvern Hills", "Broadway Tower"]
  },
  "Yorkshire": {
    area: 6081, population: 5218838,
    events: ["Jorvik Viking settlement (866 AD)", "York Minster fire (1829)", "Bronte sisters publish (1840s)"],
    landmarks: ["York Minster", "Fountains Abbey", "Yorkshire Dales"]
  }
};
      const countyLanguages = {
        "Anglesey": { name: "Sir Fôn", lang: "Welsh" },
        "Brecknockshire": { name: "Sir Frycheiniog", lang: "Welsh" },
        "Caernarfonshire": { name: "Sir Gaernarfon", lang: "Welsh" },
        "Cardiganshire": { name: "Sir Aberteifi", lang: "Welsh" },
        "Carmarthenshire": { name: "Sir Gaerfyrddin", lang: "Welsh" },
        "Denbighshire": { name: "Sir Ddinbych", lang: "Welsh" },
        "Flintshire": { name: "Sir y Fflint", lang: "Welsh" },
        "Glamorgan": { name: "Morgannwg", lang: "Welsh" },
        "Merionethshire": { name: "Meirionnydd", lang: "Welsh" },
        "Monmouthshire": { name: "Sir Fynwy", lang: "Welsh" },
        "Montgomeryshire": { name: "Sir Drefaldwyn", lang: "Welsh" },
        "Pembrokeshire": { name: "Sir Benfro", lang: "Welsh" },
        "Radnorshire": { name: "Sir Faesyfed", lang: "Welsh" },
        "Aberdeenshire": { name: "Siorrachd Obar Dheathain", lang: "Scottish Gaelic" },
        "Argyllshire": { name: "Siorrachd Earra-Ghàidheal", lang: "Scottish Gaelic" },
        "Ayrshire": { name: "Siorrachd Inbhir Àir", lang: "Scottish Gaelic" },
        "Banffshire": { name: "Siorrachd Bhanbh", lang: "Scottish Gaelic" },
        "Berwickshire": { name: "Siorrachd Bhearaig", lang: "Scottish Gaelic" },
        "Buteshire": { name: "Siorrachd Bhùth", lang: "Scottish Gaelic" },
        "Caithness": { name: "Gallaibh", lang: "Scottish Gaelic" },
        "Clackmannanshire": { name: "Siorrachd Chlach Mhanainn", lang: "Scottish Gaelic" },
        "Cromartyshire": { name: "Siorrachd Chròmbaidh", lang: "Scottish Gaelic" },
        "Dumfriesshire": { name: "Siorrachd Dhùn Phris", lang: "Scottish Gaelic" },
        "Dunbartonshire": { name: "Siorrachd Dhùn Bhreatainn", lang: "Scottish Gaelic" },
        "East Lothian": { name: "Siorrachd an Ear Leothain", lang: "Scottish Gaelic" },
        "Fife": { name: "Fìobha", lang: "Scottish Gaelic" },
        "Inverness-shire": { name: "Siorrachd Inbhir Nis", lang: "Scottish Gaelic" },
        "Kincardineshire": { name: "Siorrachd Chinn Chàrdainn", lang: "Scottish Gaelic" },
        "Kinross-shire": { name: "Siorrachd Cheann Rois", lang: "Scottish Gaelic" },
        "Kirkcudbrightshire": { name: "Siorrachd Chille Chuithbeirt", lang: "Scottish Gaelic" },
        "Lanarkshire": { name: "Siorrachd Lanraig", lang: "Scottish Gaelic" },
        "Midlothian": { name: "Meadhan Labhdaidh", lang: "Scottish Gaelic" },
        "Morayshire": { name: "Moireibh", lang: "Scottish Gaelic" },
        "Nairnshire": { name: "Siorrachd Inbhir Narann", lang: "Scottish Gaelic" },
        "Orkney": { name: "Arcaibh", lang: "Scottish Gaelic" },
        "Peeblesshire": { name: "Siorrachd nam Pùballan", lang: "Scottish Gaelic" },
        "Perthshire": { name: "Siorrachd Pheairt", lang: "Scottish Gaelic" },
        "Renfrewshire": { name: "Siorrachd Rinn Friù", lang: "Scottish Gaelic" },
        "Ross-shire": { name: "Siorrachd Rois", lang: "Scottish Gaelic" },
        "Roxburghshire": { name: "Siorrachd Rosbroig", lang: "Scottish Gaelic" },
        "Selkirkshire": { name: "Siorrachd Shailcirc", lang: "Scottish Gaelic" },
        "Shetland": { name: "Sealtainn", lang: "Scottish Gaelic" },
        "Stirlingshire": { name: "Siorrachd Shruighlea", lang: "Scottish Gaelic" },
        "Sutherland": { name: "Cataibh", lang: "Scottish Gaelic" },
        "West Lothian": { name: "Lothian an Iar", lang: "Scottish Gaelic" },
        "Wigtownshire": { name: "Siorrachd Bhaile na h-Ùige", lang: "Scottish Gaelic" },
        "Antrim": { name: "Aontroim", lang: "Irish Gaelic" },
        "Armagh": { name: "Árd Mhacha", lang: "Irish Gaelic" },
        "Down": { name: "An Dún", lang: "Irish Gaelic" },
        "Fermanagh": { name: "Fear Manach", lang: "Irish Gaelic" },
        "Londonderry": { name: "Doire", lang: "Irish Gaelic" },
        "Tyrone": { name: "Tír Eoghain", lang: "Irish Gaelic" }
      };

      // UPDATE CARD FUNCTION (NOW SEES countyData)
      window.updateCountyCard = function(englishName, layer, lat, lon) {
        const details = countyData[englishName] || {};
        const langEntry = countyLanguages[englishName];
        const area = details.area || 0;
        const pop = details.population || 0;
        const density = area > 0 ? (pop / area).toFixed(1) : 'N/A';

        let badgeStyle = '';
        if (density > 1000) badgeStyle = 'background:#9B2C2C; color:white;';
        else if (density > 500) badgeStyle = 'background:#D32F2F; color:white;';
        else if (density > 200) badgeStyle = 'background:#FF7043; color:white;';
        else if (density > 100) badgeStyle = 'background:#FFB300; color:white;';
        else if (density > 50) badgeStyle = 'background:#8BC34A; color:white;';
        else badgeStyle = 'background:#66BB6A; color:white;';

        fetchWeather(lat, lon).then(weather => {
          const weatherBlock = weather ? `<div style="text-align:center;"><div class="weather-badge">${weather.temp}°C • ${weather.desc} • Wind ${weather.wind} km/h</div><div class="weather-underline"></div></div>` : '';
          infoDiv.innerHTML = `
            <div class="county-card">
              ${weatherBlock}
              <h3 style="text-align:center; margin:0 0 10px;">${englishName}</h3>
              ${langEntry ? `<p style="margin:6px 0; font-size:0.9rem;"><strong>${langEntry.lang}:</strong> ${langEntry.name}</p>` : ''}
              <div style="display:flex; justify-content:space-between; margin:12px 0; font-size:0.95rem;">
                <div><strong>Area:</strong> ${area.toLocaleString()} sq mi</div>
                <div><strong>Pop:</strong> ${pop.toLocaleString()}</div>
              </div>
              <div style="text-align:center; margin:12px 0;">
                <span style="display:inline-block; ${badgeStyle} padding:6px 16px; border-radius:20px; font-weight:600; font-size:0.9rem; box-shadow:0 1px 3px rgba(0,0,0,0.2);">
                  Density: ${density} people/sq mi
                </span>
              </div>
              ${details.events?.length ? `<h4 style="margin:12px 0 6px; color:var(--accent);">Events</h4><ul style="margin:0; padding-left:18px; font-size:0.9rem;">${details.events.map(e=>`<li>${e}</li>`).join('')}</ul>` : ''}
              ${details.landmarks?.length ? `<h4 style="margin:12px 0 6px; color:var(--accent);">Landmarks</h4><ul style="margin:0; padding-left:18px; font-size:0.9rem;">${details.landmarks.map(l=>`<li onmouseover="showPhoto('${l}', event)" onmouseout="hidePhoto()" style="cursor:pointer; color:#0066cc;">${l}</li>`).join('')}</ul>` : ''}
            </div>`;
        });
        if (currentLayer) currentLayer.setStyle({ weight: 1, fillOpacity: 0.35 });
        layer.setStyle({ weight: 3, fillOpacity: 0.6 });
        currentLayer = layer;
      };

      // ADD GEOJSON
      const pastelColors = ["#ffdede","#dedefd","#deffde","#fff0de","#fdefff","#dfffee","#ffe7de","#f0deff","#defff5","#fdeeee","#e6f7ff","#f9ffe6","#fff6e6","#e6e6ff","#ffe6f2"];
      data.features.forEach((f, i) => f.properties.color = pastelColors[i % pastelColors.length]);

      L.geoJSON(data, {
        style: f => ({ color: "#333", weight: 1, fillColor: f.properties.color, fillOpacity: 0.35 }),
        onEachFeature: (feature, layer) => {
          const englishName = feature.properties.NAME;
          const details = countyData[englishName] || {};
          const langEntry = countyLanguages[englishName];
          const density = details.area > 0 ? Math.round(details.population / details.area) : '?';
          const centroid = turf.centroid(feature);
          const lat = centroid.geometry.coordinates[1];
          const lon = centroid.geometry.coordinates[0];

          layer.bindTooltip(`
            <div style="text-align:center; font-weight:bold; font-size:0.95rem;">
              ${englishName}<br>
              ${langEntry ? `<small>${langEntry.lang}: ${langEntry.name}</small><br>` : ''}
              <small style="color:#555;">${density} people/sq mi</small>
            </div>
          `, { direction: 'center', className: 'county-tooltip' });

          layer.on('click', () => {
            window.updateCountyCard(englishName, layer, lat, lon);
            if (window.innerWidth <= 1024) sidebar.classList.add('visible');
            map.fitBounds(layer.getBounds());
          });

          layer.on('mouseover', () => layer.setStyle({ weight: 2 }));
          layer.on('mouseout', () => layer.setStyle({ weight: 1 }));
        }
      }).addTo(map);

      setTimeout(() => map.invalidateSize(), 200);
      infoDiv.innerHTML = '<em>Click a county to explore.</em>';
    })
    .catch(err => {
      console.error(err);
      infoDiv.innerHTML = '<em style="color:red;">Failed to load map data.</em>';
    });

  // SEARCH & PLACES (unchanged)
  L.Control.geocoder({ defaultMarkGeocode: true, placeholder: 'Search town, village, postcode…' }).addTo(map);
  window.places = []; let fuse = null; let searchMarker = null;
  function parseCSVLine(line) {
    const cols = []; const regex = /(?:\"([^\"]*)\"|([^,]+))/g; let m;
    while ((m = regex.exec(line)) !== null) cols.push(m[1] || m[2] || '');
    return cols;
  }
  function initFuse() { if (window.places.length) fuse = new Fuse(window.places, { keys: ['name', 'county'], threshold: 0.3 }); }
  function showDropdown(results) {
    searchDropdown.innerHTML = '';
    if (!results.length) { searchDropdown.style.display = 'none'; return; }
    results.slice(0, 10).forEach(r => {
      const div = document.createElement('div');
      div.style.cssText = 'padding:8px 12px; cursor:pointer; border-bottom:1px solid #eee; font-size:0.9rem;';
      div.textContent = `${r.item.name}, ${r.item.county || ''}`;
      div.onmouseover = () => div.style.backgroundColor = '#f5f5f5';
      div.onmouseout = () => div.style.backgroundColor = '';
      div.onclick = () => selectPlace(r.item);
      searchDropdown.appendChild(div);
    });
    searchDropdown.style.display = 'block';
  }
  function selectPlace(place) {
    if (searchMarker) map.removeLayer(searchMarker);
    searchMarker = L.marker([place.lat, place.lon]).addTo(map).bindPopup(`<b>${place.name}</b><br>${place.county}`).openPopup();
    map.setView([place.lat, place.lon], 11);
    searchDropdown.style.display = 'none';
    searchInput.value = place.name;
    setTimeout(() => showCountyFromPoint(place.lat, place.lon), 500);
  }
  function showCountyFromPoint(lat, lon) {
    const point = turf.point([lon, lat]);
    let found = null;
    map.eachLayer(l => {
      if (l instanceof L.GeoJSON) {
        l.eachLayer(cl => {
          if (cl.getBounds && cl.getBounds().contains([lat, lon]) && turf.booleanPointInPolygon(point, cl.feature)) {
            found = cl;
          }
        });
      }
    });
    if (found) {
      const englishName = found.feature.properties.NAME;
      const centroid = turf.centroid(found.feature);
      window.updateCountyCard(englishName, found, centroid.geometry.coordinates[1], centroid.geometry.coordinates[0]);
      if (window.innerWidth <= 1024) sidebar.classList.add('visible');
    } else {
      infoDiv.innerHTML = '<em>County not found.</em>';
    }
  }
  fetch('places_clean.csv')
    .then(r => r.text())
    .then(text => {
      const lines = text.trim().split('\n'); lines.shift();
      lines.forEach(line => {
        const c = parseCSVLine(line);
        const name = c[0], desc = c[2], county = c[3], lat = parseFloat(c[6]), lon = parseFloat(c[7]);
        if ((desc === 'LOC' || desc === 'PAR') && name && !isNaN(lat) && !isNaN(lon)) {
          window.places.push({ name, county, lat, lon });
        }
      });
      initFuse();
    });
  searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim();
    if (!q || !fuse) { searchDropdown.style.display = 'none'; return; }
    showDropdown(fuse.search(q));
  });
  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && fuse) {
      const res = fuse.search(searchInput.value.trim());
      if (res.length) selectPlace(res[0].item);
    }
  });
  document.addEventListener('click', e => {
    if (!searchDropdown.contains(e.target) && e.target !== searchInput) {
      searchDropdown.style.display = 'none';
    }
  });
};
</script>
</body>
</html>
