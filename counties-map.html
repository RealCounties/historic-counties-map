<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Historic Counties Interactive Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

<style>
html, body { height: 100%; margin: 0; display: flex; font-family: Arial, sans-serif; }
#sidebar { width: 340px; background: #f7f7f7; padding: 15px; overflow-y: auto; border-right: 1px solid #ccc; }
#map { flex: 1; height: 100vh; width: calc(100% - 340px); position: relative; z-index: 1; }
.county-card { background: #fff; padding: 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
.county-card h3 { margin-top: 0; color: #333; }
.county-card p { margin: 4px 0; }
.county-card a { color: #0066cc; text-decoration: none; }
.county-card a:hover { text-decoration: underline; }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Historic Counties</h2>
  <p>Select a county to view details.</p>
  <div id="info"><em>No county selected.</em></div>
</div>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<script>
// Initialize map
var map = L.map('map', { center: [54.5, -3], zoom: 6, minZoom: 5 });

// Restrict map to British Isles
var ukBounds = L.latLngBounds([49.5, -8.5], [60.9, 2.0]);
map.setMaxBounds(ukBounds);
map.fitBounds(ukBounds);

// Base OSM map
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
  maxZoom: 19
}).addTo(map);

// Sidebar element
var infoDiv = document.getElementById('info');

// Predefined pastel county colors
var countyColours = {
  "Aberdeenshire":"#fbb4ae","Anglesey":"#b3cde3","Angus":"#ccebc5","Antrim":"#decbe4","Argyllshire":"#fed9a6",
  "Armagh":"#ffffcc","Ayrshire":"#e5d8bd","Banffshire":"#fddaec","Bedfordshire":"#f2f2f2","Berkshire":"#b3e2cd",
  "Berwickshire":"#fdcdac","Brecknockshire":"#cbd5e8","Buckinghamshire":"#f4cae4","Buteshire":"#e6f5c9",
  "Caernarfonshire":"#fff2ae","Caithness":"#f1e2cc","Cambridgeshire":"#cccccc","Cardiganshire":"#a6cee3",
  "Carmarthenshire":"#1f78b4","Cheshire":"#b2df8a","Clackmannanshire":"#33a02c","Cornwall":"#fb9a99",
  "Cromartyshire":"#e31a1c","Cumberland":"#fdbf6f","Denbighshire":"#ff7f00","Derbyshire":"#cab2d6",
  "Devon":"#6a3d9a","Dorset":"#ffff99","Down":"#b15928","Dumfriesshire":"#8dd3c7","Dunbartonshire":"#ffffb3",
  "Durham":"#bebada","East Lothian":"#fb8072","Essex":"#80b1d3","Fermanagh":"#fdb462","Fife":"#b3de69",
  "Flintshire":"#fccde5","Glamorgan":"#d9d9d9","Gloucestershire":"#bc80bd","Hampshire":"#ccebc5",
  "Herefordshire":"#ffed6f","Hertfordshire":"#1f78b4","Huntingdonshire":"#a6cee3","Inverness-shire":"#fbb4ae",
  "Kent":"#b3cde3","Kincardineshire":"#ccebc5","Kinross-shire":"#decbe4","Kirkcudbrightshire":"#fed9a6",
  "Lanarkshire":"#ffffcc","Lancashire":"#e5d8bd","Leicestershire":"#fddaec","Lincolnshire":"#f2f2f2",
  "Londonderry":"#b3e2cd","Merionethshire":"#fdcdac","Middlesex":"#cbd5e8","Midlothian":"#f4cae4",
  "Monmouthshire":"#e6f5c9","Montgomeryshire":"#fff2ae","Morayshire":"#f1e2cc","Nairnshire":"#cccccc",
  "Norfolk":"#a6cee3","Northamptonshire":"#1f78b4","Northumberland":"#b2df8a","Nottinghamshire":"#33a02c",
  "Orkney":"#fb9a99","Oxfordshire":"#e31a1c","Peeblesshire":"#fdbf6f","Pembrokeshire":"#ff7f00",
  "Perthshire":"#cab2d6","Radnorshire":"#6a3d9a","Renfrewshire":"#ffff99","Ross-shire":"#b15928",
  "Roxburghshire":"#8dd3c7","Rutland":"#ffffb3","Selkirkshire":"#bebada","Shetland":"#fb8072",
  "Shropshire":"#80b1d3","Somerset":"#fccde5","Staffordshire":"#d9d9d9","Stirlingshire":"#bc80bd",
  "Suffolk":"#ccebc5","Surrey":"#ffed6f","Sussex":"#1f78b4","Sutherland":"#a6cee3","Tyrone":"#b2df8a",
  "Warwickshire":"#33a02c","West Lothian":"#fb9a99","Westmorland":"#e31a1c","Wigtownshire":"#fdbf6f",
  "Wiltshire":"#ff7f00","Worcestershire":"#cab2d6","Yorkshire":"#6a3d9a"
};

// County data with area & population
var countyData = {
  "Aberdeenshire": { area: "1,950 sq mi", population: "380,495", link: "" },
  "Anglesey": { area: "277 sq mi", population: "69,751", link: "" },
  "Angus": { area: "899 sq mi", population: "264,044", link: "" },
  "Antrim": { area: "1,175 sq mi", population: "615,701", link: "" },
  "Argyllshire": { area: "3,110 sq mi", population: "64,819", link: "" },
  "Armagh": { area: "512 sq mi", population: "178,598", link: "" },
  "Ayrshire": { area: "1,129 sq mi", population: "367,676", link: "" },
  "Banffshire": { area: "641 sq mi", population: "46,537", link: "" },
  "Bedfordshire": { area: "468 sq mi", population: "602,847", link: "" },
  "Berkshire": { area: "722 sq mi", population: "842,804", link: "" },
  "Berwickshire": { area: "457 sq mi", population: "26,458", link: "" },
  "Brecknockshire": { area: "742 sq mi", population: "67,598", link: "" },
  "Buckinghamshire": { area: "746 sq mi", population: "916,903", link: "" },
  "Buteshire": { area: "225 sq mi", population: "12,534", link: "" },
  "Caernarfonshire": { area: "563 sq mi", population: "139,065", link: "" },
  "Caithness": { area: "618 sq mi", population: "26,486", link: "" },
  "Cambridgeshire": { area: "858 sq mi", population: "460,448", link: "" },
  "Cardiganshire": { area: "693 sq mi", population: "75,784", link: "" },
  "Carmarthenshire": { area: "937 sq mi", population: "184,232", link: "" },
  "Cheshire": { area: "1,035 sq mi", population: "1,668,894", link: "" },
  "Clackmannanshire": { area: "48 sq mi", population: "50,957", link: "" },
  "Cornwall": { area: "1,365 sq mi", population: "533,594", link: "" },
  "Cromartyshire": { area: "370 sq mi", population: "7,074", link: "" },
  "Cumberland": { area: "1,525 sq mi", population: "306,241", link: "" },
  "Denbighshire": { area: "668 sq mi", population: "227,680", link: "" },
  "Derbyshire": { area: "1,017 sq mi", population: "1,148,373", link: "" },
  "Devon": { area: "2,621 sq mi", population: "1,133,463", link: "" },
  "Dorset": { area: "1,005 sq mi", population: "543,296", link: "" },
  "Down": { area: "950 sq mi", population: "528,983", link: "" },
  "Dumfriesshire": { area: "1,063 sq mi", population: "77,160", link: "" },
  "Dunbartonshire": { area: "241 sq mi", population: "262,419", link: "" },
  "Durham": { area: "1,022 sq mi", population: "1,467,037", link: "" },
// … continue all counties like above …
  "Yorkshire": { area: "6,081 sq mi", population: "5,218,838", link: "" }
};

// Load GeoJSON
fetch('./counties_simplified8.json')
  .then(res => res.json())
  .then(data => {
    var geoJsonLayer = L.geoJSON(data, { 
      style: function(feature) {
        var name = feature.properties.NAME;
        return { color: "#333", weight: 1, fillColor: countyColours[name]||"#cccccc", fillOpacity: 0.5 };
      },
      // Reset map bounds button
var resetBtn = document.createElement('button');
resetBtn.innerText = "Reset Map Bounds";
resetBtn.style.marginTop = "10px";
resetBtn.style.padding = "6px 12px";
resetBtn.style.cursor = "pointer";
resetBtn.onclick = function() {
    map.fitBounds(ukBounds);
};
document.getElementById('sidebar').appendChild(resetBtn);

// Load GeoJSON
fetch('./counties_simplified8.json')
  .then(res => res.json())
  .then(data => {
    var geoJsonLayer = L.geoJSON(data, { 
      style: function(feature) {
        var name = feature.properties.NAME;
        return { color: "#333", weight: 1, fillColor: countyColours[name]||"#cccccc", fillOpacity: 0.5 };
      },
      onEachFeature: function(feature, layer) {
        const details = countyData[feature.properties.NAME];

        // Tooltip
        layer.bindTooltip(`${feature.properties.NAME} — ${details?.area||'Unknown'} — ${details?.population||'Unknown'}`);

        // Click for sidebar
        layer.on('click', function() {
          if(details){
            const areaNum = parseFloat(details.area.replace(/[^0-9.]/g,'')); // numeric area
            const popNum = parseInt(details.population.replace(/,/g,'')); // numeric population
            const density = areaNum && popNum ? (popNum / areaNum).toFixed(1) : "N/A";

            infoDiv.innerHTML = `<div class="county-card">
              <h3>${feature.properties.NAME}</h3>
              <p><strong>Area:</strong> ${details.area}</p>
              <p><strong>Population:</strong> ${details.population}</p>
              <p><strong>Population Density:</strong> ${density} per sq mi</p>
              <p><a href="${details.link}" target="_blank">More about ${feature.properties.NAME}</a></p>
            </div>`;
          } else {
            infoDiv.innerHTML = `<div class="county-card"><h3>${feature.properties.NAME}</h3><p>No extra data available yet.</p></div>`;
          }
          map.fitBounds(layer.getBounds());
        });

        // Hover highlighting
        layer.on('mouseover', function(){ layer.setStyle({ weight: 2 }); });
        layer.on('mouseout', function(){ layer.setStyle({ weight: 1 }); });
      }
    }).addTo(map);

    map.fitBounds(geoJsonLayer.getBounds());
  });

// Add search control
L.Control.geocoder({ placeholder: 'Search…' }).addTo(map);

</script>
</body>
</html>
